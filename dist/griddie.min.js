"use strict";var _extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},_createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}!function(t,e){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("Griddie",e):t.Griddie=e()}(this,function(){navigator.userAgent.toLowerCase();var t,e=["WebKit","Moz","O","Ms",""],i=function(){for(var t=0;t<e.length;t++)if(e[t]+"MutationObserver"in window)return window[e[t]+"MutationObserver"];return!1}(),n=(function(){var t=document.createElement("div"),e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",msTransition:"MSTransitionEnd",transition:"transitionend"};for(var i in e)if(void 0!==t.style[i])return e[i]}(),function(t,e){return e+[].concat(_toConsumableArray(t.classList)).join("")+t.id+"Observer"}),s=function(t,e,i){var s=n(t,i+e);t[s]&&(t[s].disconnect(),delete t[s])},o=function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];window["clear"+e](t[i]),delete t[i];var o=t.parentElement;n&&s(o,e,i)},r=function(t){return function(t,e,r,l,a){o(t,e,a),t[a]=window["set"+e](r,l);var c=t.parentElement,h=n(c,a+e);c[h]=new i(function(i){[].concat(_toConsumableArray(i[0].removedNodes)).some(function(e){return e===t})&&(o(t,e,a),s(c,e,a))}),c[h].observe(c,{childList:!0})}(t,"Timeout",arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,arguments.length>3&&void 0!==arguments[3]?arguments[3]:"niteTimeout")},l=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"niteTimeout";return o(t,"Timeout",e,!0)},a=function(t,e){return String.prototype.includes?t.includes(e):-1!==t.indexOf(e,0)},c=function(){function t(){_classCallCheck(this,t),this._window=window,this._html=document.documentElement,this._body=document.body,this._frame1=this._window,this._frame2=this._html||this._body,this._prefix1="inner",this._prefix2="offset",!this._prefix1+"Width"in this._frame1&&(this._prefix1="client",this._frame1=this._frame2),this._offsetWidth=0,this._offsetHeight=0,this._width=0,this._height=0,this._scrollTop=0,this._scrollLeft=0,this._lock=!1,this.calcAll()}return _createClass(t,[{key:"calcOffsetWidth",value:function(){return this._offsetWidth=this._body[this._prefix2+"Width"],this.offsetWidth}},{key:"calcOffsetHeight",value:function(){return this._offsetHeight=this._body[this._prefix2+"Height"],this.offsetHeight}},{key:"calcWidth",value:function(){return this._width=this._frame1[this._prefix1+"Width"],this.width}},{key:"calcHeight",value:function(){return this._height=this._frame1[this._prefix1+"Height"],this.height}},{key:"calcScrollTop",value:function(){return this._scrollTop=this._frame2.scrollTop||0,this.scrollTop}},{key:"calcScrollLeft",value:function(){return this._scrollLeft=this._frame2.scrollLeft||0,this.scrollLeft}},{key:"calcAll",value:function(){return this.calcOffsetWidth(),this.calcOffsetHeight(),this.calcWidth(),this.calcHeight(),this.calcScrollTop(),this.calcScrollLeft(),this.all}},{key:"offsetWidth",get:function(){return this._offsetWidth}},{key:"offsetHeight",get:function(){return this._offsetHeight}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"scrollTop",get:function(){return this._scrollTop}},{key:"scrollLeft",get:function(){return this._scrollLeft}},{key:"all",get:function(){return{offsetWidth:this.offsetWidth,offsetHeight:this.offsetHeight,width:this.width,height:this.height,scrollTop:this.scrollTop,scrollLeft:this.scrollLeft}}},{key:"lock",get:function(){return this._lock},set:function(t){if(this._lock=t,this._lock){this._body.style.top=-this.calcScrollTop()+"px",this._body.style.left=-this.calcScrollLeft()+"px";var e=this.calcOffsetWidth(),i=this.calcOffsetHeight();this._html.style.top="0px",this._html.style.left="0px",this._html.style.position="fixed",this._body.style.position="fixed",this._html.style.width="100%",this._body.style.width="100%";var n=this.calcOffsetWidth(),s=this.calcOffsetHeight();e=n-e,i=s-i,this._body.style.width=n-e+"px",this._body.style.height=s-i+"px"}else{var o=Math.abs(parseFloat(this._body.style.top)),r=Math.abs(parseFloat(this._body.style.left));this._html.style.position="",this._html.style.top="",this._html.style.left="",this._html.style.width="",this._body.style.position="",this._body.style.top="",this._body.style.left="",this._body.style.width="",this._window.scroll({top:o,left:r,behavior:"instant"})}}}]),t}(),h={},f=(window.CustomEvent||((t=function(t,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var i=document.createEvent("CustomEvent");return i.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),i}).prototype=window.Event.prototype),function t(e,i){var n,s;if(e&&"string"==typeof i)if(n=i,s=".",String.prototype.startsWith?n.startsWith(s):n.substr(0,s.length)===s)for(var o in h){var r=o.replace("__namespace__",".");a(r,i)&&h[o].element===e&&t(e,r)}else{var l=(i=i.split("."))[0];i[1]&&(i=i.join("__namespace__")),i in h&&(e.removeEventListener(l,h[i].handler),delete h[i])}}),u=function(t,e,i,n){if(t&&"string"==typeof e&&"function"==typeof i){var s=(e=e.split("."))[0];if(e[1]&&(e=e.join("__namespace__")),h[e]={element:t,count:0,once:!1},!0===n){var o=i;i=function(i){if(e in h){if(h[e].count++,h[e].once&&h[e].count>1)return;o.call(this,i)}f(t,e)}}else n=!1;h[e]=_extends({},h[e],{handler:i,once:n}),t.addEventListener(s,h[e].handler,{once:n})}};return function(){function t(e,i){var n=this;_classCallCheck(this,t),this._element=e,this._items=[].concat(_toConsumableArray(this._element.children)),this._options={},this._viewport=new c,this._element.instance=this,this.options=i,this.layout(),u(window,"resize.griddie",function(){return n.layout()})}return _createClass(t,[{key:"animate",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};if("instance"in this._element)return new Promise(function(i,n){var s=function(){t.clearGridStyles(),t.clearItemsStyles(),t.layout(),t.storeGridData(1),t.storeItemsData(1),t.applyGridStyles(0),t.applyItemsStyles(0),requestAnimationFrame(function(){var e="transform "+t._options.transformTimingCSS+"s ease",n="width "+t._options.transformTimingCSS+"s ease, height "+t._options.transformTimingCSS+"s ease";t._element.style.transition=n+", "+e,[].concat(_toConsumableArray(t._items)).filter(function(t){return"none"!==t.style.display}).forEach(function(i){var s=e;t.options.scaleXY||(s+=", "+n),i.style.transition=s}),requestAnimationFrame(function(){t.applyGridStyles(1),t.applyItemsStyles(1)}),r(t._element,function(){t.clearGridStyles(),t.clearItemsStyles(),i()},t.options.transformTiming,"transform")})};l(t._element,"transform"),t.clearGridStyles(),t.clearItemsStyles(),t.storeGridData(0),t.storeItemsData(0),t.applyGridStyles(0),t.applyItemsStyles(0);var o,a=e();!(o=a)||"object"!==(void 0===o?"undefined":_typeof(o))&&"function"!=typeof o||"function"!=typeof o.then?requestAnimationFrame(function(){return s()}):a.then(function(){return s()})})}},{key:"filter",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"*";if("instance"in this._element){var i=this._items.filter(function(t){return t.matches(e)}),n=this._items.filter(function(t){return!t.matches(e)}),s=i.filter(function(t){return"none"===t.style.display}),o=i.length!==s.length,a=function(){t._items.forEach(function(e){e.style.transition="opacity "+t._options.opacityTimingCSS+"s ease"})},c=function(){i.forEach(function(t){t.style.opacity=1}),n.forEach(function(t){t.style.opacity=0})},h=function(){t._items.forEach(function(t){t.style.transition="",t.style.opacity=""}),i.forEach(function(t){t.style.display=""}),n.forEach(function(t){t.style.display="none"})};this.animate(function(){return l(t._element,"opacity"),new Promise(function(e,i){var n=function(){t.storeItemsData(0),t.applyGridStyles(0),t.applyItemsStyles(0),e()};a(),s.length&&s.forEach(function(t){t.style.opacity=0}),requestAnimationFrame(function(){s.length&&s.forEach(function(t){t.style.display=""}),s.length&&o?requestAnimationFrame(function(){return n()}):(!s.length||s.length&&!o)&&requestAnimationFrame(function(){c(),r(t._element,function(){h(),requestAnimationFrame(function(){return n()})},t.options.opacityTiming,"opacity")})})})}).then(function(){o&&(a(),requestAnimationFrame(function(){c(),clearTimeout(t._filterTimeout),t._filterTimeout=setTimeout(function(){return h()},t.options.opacityTiming)}))})}}},{key:"destroy",value:function(){this.clearGridStyles(),this.clearItemsStyles(),this._items.forEach(function(t){t.style.gridRowEnd="",t.style.display="",delete t.rect}),delete this._element.rect,l(this._element,"transform"),l(this._element,"opacity"),f(window,"resize.griddie"),delete this._element.instance}},{key:"refresh",value:function(){this._element}},{key:"layout",value:function(){if("instance"in this._element){this._element.style.position="relative";var t=window.getComputedStyle(this._element),e=t.getPropertyValue("display");if(this._options.masonry){"none"===t.getPropertyValue("grid-template-columns")&&(this._element.style.gridTemplateColumns="repeat(auto-fill, minmax(250px, 1fr))"),"grid"!==e&&(this._element.style.display="grid");var i=t.getPropertyValue("grid-auto-rows");"auto"===i&&(i=this._element.style.gridAutoRows="20px"),i=parseInt(i),"normal"===t.getPropertyValue("grid-column-gap")&&(this._element.style.gridColumnGap="0px");var n=t.getPropertyValue("grid-row-gap");"normal"===n&&(n=this._element.style.gridRowGap="0px"),n=parseInt(n),this._items.filter(function(t){return"none"!==t.style.display}).forEach(function(t){var e=Math.ceil(([].concat(_toConsumableArray(t.children))[0].getBoundingClientRect().height+n)/(i+n));t.style.gridRowEnd="span "+e})}else this._element.style.display="",this._element.style.gridTemplateColumns="",this._element.style.gridAutoRows="",this._element.style.gridColumnGap="",this._element.style.gridRowGap="",this._items.filter(function(t){return"none"!==t.style.display}).forEach(function(t){t.style.gridRowEnd=""})}}},{key:"clearGridStyles",value:function(){"instance"in this._element&&(this._element.style.position="relative",this._element.style.transform="",this._element.style.width="",this._element.style.height="",this._element.style.transition="",this._element.style.margin="")}},{key:"clearItemsStyles",value:function(){"instance"in this._element&&this._items.forEach(function(t){t.style.transform="",t.style.transformOrigin="",t.style.position="",t.style.transition="",t.style.width="",t.style.height="",t.style.margin=""})}},{key:"storeGridData",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if("instance"in this._element){this._viewport.calcScrollTop(),this._viewport.calcScrollLeft();var e=this._element.getBoundingClientRect(),i=window.getComputedStyle(this._element);"rect"in this._element||(this._element.rect=[]),this._element.rect[t]={width:e.width,height:e.height,top:e.top+this._viewport.scrollTop,left:e.left+this._viewport.scrollLeft,marginTop:parseInt(i.getPropertyValue("margin-top")),marginLeft:parseInt(i.getPropertyValue("margin-left"))}}}},{key:"storeItemsData",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;"instance"in this._element&&(this._viewport.calcScrollTop(),this._viewport.calcScrollLeft(),this._items.filter(function(t){return"none"!==t.style.display}).forEach(function(i){"rect"in i||(i.rect=[]);var n=i.getBoundingClientRect();if(i.rect[e]={width:n.width,height:n.height,top:n.top+t._viewport.scrollTop-t._element.rect[e].top,left:n.left+t._viewport.scrollLeft-t._element.rect[e].left,scaleX:1,scaleY:1},i.rect[e].top=i.rect[e].top>=0?i.rect[e].top:0,i.rect[e].left=i.rect[e].left>=0?i.rect[e].left:0,1===e){var s=i.rect[0].width/n.width,o=i.rect[0].height/n.height;s>0&&(i.rect[e].scaleX=1/s),o>0&&(i.rect[e].scaleY=1/o)}}))}},{key:"applyGridStyles",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;"instance"in this._element&&(this._element.style.margin=0,this._element.style.position="relative",this._element.style.transformOrigin="0 0 0",this._element.style.transform="translate3d("+this._element.rect[t].marginLeft+"px,"+this._element.rect[t].marginTop+"px, 0px)",this._element.style.width=this._element.rect[t].width+"px",this._element.style.height=this._element.rect[t].height+"px")}},{key:"applyItemsStyles",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;"instance"in this._element&&this._items.filter(function(t){return"none"!==t.style.display}).forEach(function(i){var n="translate3d("+i.rect[e].left+"px,"+i.rect[e].top+"px, 0px)";t.options.scaleXY&&(n+=" scale3d("+i.rect[e].scaleX+", "+i.rect[e].scaleY+", 1)"),t.options.scaleXY&&0!==e||(i.style.width=i.rect[e].width+"px",i.style.height=i.rect[e].height+"px"),i.style.margin=0,i.style.position="absolute",i.style.transformOrigin="0 0 0",i.style.transform=n})}},{key:"options",set:function(t){this._options=_extends({scaleXY:!1,opacityTiming:300,transformTiming:300,masonry:!1},t),this._options.transformTimingCSS=this.options.transformTiming/1e3,this._options.opacityTimingCSS=this.options.opacityTiming/1e3},get:function(){return this._options}}]),t}()});
//# sourceMappingURL=griddie.min.js.map
