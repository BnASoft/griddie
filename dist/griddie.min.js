!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("Griddie",e):t.Griddie=e()}(this,function(){"use strict";const t=t=>!!t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof t.then,e=(navigator.userAgent.toLowerCase(),["WebKit","Moz","O","Ms",""]),i=(()=>{for(let t=0;t<e.length;t++)if(e[t]+"MutationObserver"in window)return window[e[t]+"MutationObserver"];return!1})(),s=((()=>{const t=document.createElement("div"),e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",msTransition:"MSTransitionEnd",transition:"transitionend"};for(let i in e)if(void 0!==t.style[i])return e[i]})(),(t,e)=>e+[...t.classList].join("")+t.id+"Observer"),l=(t,e,i)=>{const l=s(t,i+e);t[l]&&(t[l].disconnect(),delete t[l])},n=(t,e,i,s=!1)=>{window["clear"+e](t[i]),delete t[i];const n=t.parentElement;s&&l(n,e,i)},o=(t,e=(()=>{}),o=0,r="niteTimeout")=>((t,e,o,r,h)=>{n(t,e,h),t[h]=window["set"+e](o,r);const a=t.parentElement,c=s(a,h+e);a[c]=new i(i=>{[...i[0].removedNodes].some(e=>e===t)&&(n(t,e,h),l(a,e,h))}),a[c].observe(a,{childList:!0})})(t,"Timeout",e,o,r),r=(t,e="niteTimeout")=>n(t,"Timeout",e,!0),h=(t,e)=>String.prototype.includes?t.includes(e):-1!==t.indexOf(e,0);class a{constructor(){this._window=window,this._html=document.documentElement,this._body=document.body,this._frame1=this._window,this._frame2=this._html||this._body,this._prefix1="inner",this._prefix2="offset",!this._prefix1+"Width"in this._frame1&&(this._prefix1="client",this._frame1=this._frame2),this._offsetWidth=0,this._offsetHeight=0,this._width=0,this._height=0,this._scrollTop=0,this._scrollLeft=0,this._lock=!1,this.calcAll()}get offsetWidth(){return this._offsetWidth}get offsetHeight(){return this._offsetHeight}get width(){return this._width}get height(){return this._height}get scrollTop(){return this._scrollTop}get scrollLeft(){return this._scrollLeft}get all(){return{offsetWidth:this.offsetWidth,offsetHeight:this.offsetHeight,width:this.width,height:this.height,scrollTop:this.scrollTop,scrollLeft:this.scrollLeft}}calcOffsetWidth(){return this._offsetWidth=this._body[this._prefix2+"Width"],this.offsetWidth}calcOffsetHeight(){return this._offsetHeight=this._body[this._prefix2+"Height"],this.offsetHeight}calcWidth(){return this._width=this._frame1[this._prefix1+"Width"],this.width}calcHeight(){return this._height=this._frame1[this._prefix1+"Height"],this.height}calcScrollTop(){return this._scrollTop=this._frame2.scrollTop||0,this.scrollTop}calcScrollLeft(){return this._scrollLeft=this._frame2.scrollLeft||0,this.scrollLeft}calcAll(){return this.calcOffsetWidth(),this.calcOffsetHeight(),this.calcWidth(),this.calcHeight(),this.calcScrollTop(),this.calcScrollLeft(),this.all}get lock(){return this._lock}set lock(t){if(this._lock=t,this._lock){this._body.style.top=-this.calcScrollTop()+"px",this._body.style.left=-this.calcScrollLeft()+"px";let t=this.calcOffsetWidth(),e=this.calcOffsetHeight();this._html.style.top="0px",this._html.style.left="0px",this._html.style.position="fixed",this._body.style.position="fixed",this._html.style.width="100%",this._body.style.width="100%";let i=this.calcOffsetWidth(),s=this.calcOffsetHeight();t=i-t,e=s-e,this._body.style.width=i-t+"px",this._body.style.height=s-e+"px"}else{let t=Math.abs(parseFloat(this._body.style.top)),e=Math.abs(parseFloat(this._body.style.left));this._html.style.position="",this._html.style.top="",this._html.style.left="",this._html.style.width="",this._body.style.position="",this._body.style.top="",this._body.style.left="",this._body.style.width="",this._window.scroll({top:t,left:e,behavior:"instant"})}}}let c={};window.CustomEvent||(()=>{const t=(t,e)=>{e=e||{bubbles:!1,cancelable:!1,detail:void 0};const i=document.createEvent("CustomEvent");return i.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),i};t.prototype=window.Event.prototype})();const m=(t,e)=>{if(t&&"string"==typeof e)if(((t,e)=>String.prototype.startsWith?t.startsWith(e):t.substr(0,e.length)===e)(e,"."))for(let i in c){const s=i.replace("__namespace__",".");h(s,e)&&c[i].element===t&&m(t,s)}else{const i=(e=e.split("."))[0];e[1]&&(e=e.join("__namespace__")),e in c&&(t.removeEventListener(i,c[e].handler),delete c[e])}},p=(t,e,i,s)=>{if(!t||"string"!=typeof e||"function"!=typeof i)return;const l=(e=e.split("."))[0];if(e[1]&&(e=e.join("__namespace__")),c[e]={element:t,count:0,once:!1},!0===s){let s=i;i=function(i){if(e in c){if(c[e].count++,c[e].once&&c[e].count>1)return;s.call(this,i)}m(t,e)}}else s=!1;c[e]={...c[e],...{handler:i,once:s}},t.addEventListener(l,c[e].handler,{once:s})};return class{constructor(t,e){this._element=t,this._items=[...this._element.children],this._options={},this._viewport=new a,this._element.instance=this,this.options=e,this.layout(),p(window,"resize.griddie",()=>this.layout())}set options(t){this._options={...{scaleXY:!1,opacityTiming:300,transformTiming:300,masonry:!1},...t},this._options.transformTimingCSS=this.options.transformTiming/1e3,this._options.opacityTimingCSS=this.options.opacityTiming/1e3}get options(){return this._options}animate(e=(()=>{})){if("instance"in this._element)return new Promise((i,s)=>{const l=()=>{this.clearGridStyles(),this.clearItemsStyles(),this.layout(),this.storeGridData(1),this.storeItemsData(1),this.applyGridStyles(0),this.applyItemsStyles(0),requestAnimationFrame(()=>{const t="transform "+this._options.transformTimingCSS+"s ease",e="width "+this._options.transformTimingCSS+"s ease, height "+this._options.transformTimingCSS+"s ease";this._element.style.transition=e+", "+t,[...this._items].filter(t=>"none"!==t.style.display).forEach(i=>{let s=t;this.options.scaleXY||(s+=", "+e),i.style.transition=s}),requestAnimationFrame(()=>{this.applyGridStyles(1),this.applyItemsStyles(1)}),o(this._element,()=>{this.clearGridStyles(),this.clearItemsStyles(),i()},this.options.transformTiming,"transform")})};r(this._element,"transform"),this.clearGridStyles(),this.clearItemsStyles(),this.storeGridData(0),this.storeItemsData(0),this.applyGridStyles(0),this.applyItemsStyles(0);const n=e();t(n)?n.then(()=>l()):requestAnimationFrame(()=>l())})}filter(t="*"){if(!("instance"in this._element))return;const e=this._items.filter(e=>e.matches(t)),i=this._items.filter(e=>!e.matches(t)),s=e.filter(t=>"none"===t.style.display),l=e.length!==s.length,n=()=>{this._items.forEach(t=>{t.style.transition="opacity "+this._options.opacityTimingCSS+"s ease"})},h=()=>{e.forEach(t=>{t.style.opacity=1}),i.forEach(t=>{t.style.opacity=0})},a=()=>{this._items.forEach(t=>{t.style.transition="",t.style.opacity=""}),e.forEach(t=>{t.style.display=""}),i.forEach(t=>{t.style.display="none"})};this.animate(()=>(r(this._element,"opacity"),new Promise((t,e)=>{const i=()=>{this.storeItemsData(0),this.applyGridStyles(0),this.applyItemsStyles(0),t()};n(),s.length&&s.forEach(t=>{t.style.opacity=0}),requestAnimationFrame(()=>{s.length&&s.forEach(t=>{t.style.display=""}),s.length&&l?requestAnimationFrame(()=>i()):(!s.length||s.length&&!l)&&requestAnimationFrame(()=>{h(),o(this._element,()=>{a(),requestAnimationFrame(()=>i())},this.options.opacityTiming,"opacity")})})}))).then(()=>{l&&(n(),requestAnimationFrame(()=>{h(),clearTimeout(this._filterTimeout),this._filterTimeout=setTimeout(()=>a(),this.options.opacityTiming)}))})}destroy(){this.clearGridStyles(),this.clearItemsStyles(),this._items.forEach(t=>{t.style.gridRowEnd="",t.style.display="",delete t.rect}),delete this._element.rect,r(this._element,"transform"),r(this._element,"opacity"),m(window,"resize.griddie"),delete this._element.instance}refresh(){this._element}layout(){if(!("instance"in this._element))return;this._element.style.position="relative";const t=window.getComputedStyle(this._element),e=t.getPropertyValue("display");if(this._options.masonry){"none"===t.getPropertyValue("grid-template-columns")&&(this._element.style.gridTemplateColumns="repeat(auto-fill, minmax(250px, 1fr))"),"grid"!==e&&(this._element.style.display="grid");let i=t.getPropertyValue("grid-auto-rows");"auto"===i&&(i=this._element.style.gridAutoRows="20px"),i=parseInt(i),"normal"===t.getPropertyValue("grid-column-gap")&&(this._element.style.gridColumnGap="0px");let s=t.getPropertyValue("grid-row-gap");"normal"===s&&(s=this._element.style.gridRowGap="0px"),s=parseInt(s),this._items.filter(t=>"none"!==t.style.display).forEach(t=>{const e=Math.ceil(([...t.children][0].getBoundingClientRect().height+s)/(i+s));t.style.gridRowEnd="span "+e})}else this._element.style.display="",this._element.style.gridTemplateColumns="",this._element.style.gridAutoRows="",this._element.style.gridColumnGap="",this._element.style.gridRowGap="",this._items.filter(t=>"none"!==t.style.display).forEach(t=>{t.style.gridRowEnd=""})}clearGridStyles(){"instance"in this._element&&(this._element.style.position="relative",this._element.style.transform="",this._element.style.width="",this._element.style.height="",this._element.style.transition="",this._element.style.margin="")}clearItemsStyles(){"instance"in this._element&&this._items.forEach(t=>{t.style.transform="",t.style.transformOrigin="",t.style.position="",t.style.transition="",t.style.width="",t.style.height="",t.style.margin=""})}storeGridData(t=0){if(!("instance"in this._element))return;this._viewport.calcScrollTop(),this._viewport.calcScrollLeft();const e=this._element.getBoundingClientRect(),i=window.getComputedStyle(this._element);"rect"in this._element||(this._element.rect=[]),this._element.rect[t]={width:e.width,height:e.height,top:e.top+this._viewport.scrollTop,left:e.left+this._viewport.scrollLeft,marginTop:parseInt(i.getPropertyValue("margin-top")),marginLeft:parseInt(i.getPropertyValue("margin-left"))}}storeItemsData(t=0){"instance"in this._element&&(this._viewport.calcScrollTop(),this._viewport.calcScrollLeft(),this._items.filter(t=>"none"!==t.style.display).forEach(e=>{"rect"in e||(e.rect=[]);const i=e.getBoundingClientRect();if(e.rect[t]={width:i.width,height:i.height,top:i.top+this._viewport.scrollTop-this._element.rect[t].top,left:i.left+this._viewport.scrollLeft-this._element.rect[t].left,scaleX:1,scaleY:1},e.rect[t].top=e.rect[t].top>=0?e.rect[t].top:0,e.rect[t].left=e.rect[t].left>=0?e.rect[t].left:0,1===t){const s=e.rect[0].width/i.width,l=e.rect[0].height/i.height;s>0&&(e.rect[t].scaleX=1/s),l>0&&(e.rect[t].scaleY=1/l)}}))}applyGridStyles(t=0){"instance"in this._element&&(this._element.style.margin=0,this._element.style.position="relative",this._element.style.transformOrigin="0 0 0",this._element.style.transform="translate3d("+this._element.rect[t].marginLeft+"px,"+this._element.rect[t].marginTop+"px, 0px)",this._element.style.width=this._element.rect[t].width+"px",this._element.style.height=this._element.rect[t].height+"px")}applyItemsStyles(t=0){"instance"in this._element&&this._items.filter(t=>"none"!==t.style.display).forEach(e=>{let i="translate3d("+e.rect[t].left+"px,"+e.rect[t].top+"px, 0px)";this.options.scaleXY&&(i+=" scale3d("+e.rect[t].scaleX+", "+e.rect[t].scaleY+", 1)"),this.options.scaleXY&&0!==t||(e.style.width=e.rect[t].width+"px",e.style.height=e.rect[t].height+"px"),e.style.margin=0,e.style.position="absolute",e.style.transformOrigin="0 0 0",e.style.transform=i})}}});
//# sourceMappingURL=griddie.min.js.map
