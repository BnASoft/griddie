{"version":3,"sources":["griddie.js"],"names":["_extends","Object","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","_createClass","defineProperties","props","descriptor","enumerable","configurable","writable","defineProperty","Constructor","protoProps","staticProps","_typeof","Symbol","iterator","obj","constructor","_classCallCheck","instance","TypeError","_toConsumableArray","arr","Array","isArray","arr2","from","global","factory","exports","module","define","amd","Griddie","this","navigator","userAgent","toLowerCase","vendorsPrefixes","MutationObserver","window","getObserverId","el","document","createElement","transEndEventNames","WebkitTransition","MozTransition","OTransition","msTransition","transition","name","undefined","style","parent","prefix","concat","classList","join","id","disconnectObserver","mode","observerId","disconnect","clearElementTimer","element","autoDisconnectObserver","parentElement","attachTimeout","callback","time","e","removedNodes","some","observe","childList","setElementTimer","options","_this","_options","layout","addEventListener","value","_this2","layoutChanges","Promise","resolve","reject","clear","store","transform","requestAnimationFrame","transformTimingCSS","items","filter","item","display","forEach","animateWidthAndHeight","transformTiming","object","changes","then","_this3","_filter","matched","x","matches","unmatched","hiddenMatched","makeRoomBeforeFade","prepareFade","opacityTimingCSS","fade","opacity","clearFade","animate","onFadeEnd","opacityTiming","clearTimeout","_filterTimeout","setTimeout","masonry","rowHeight","parseInt","getComputedStyle","getPropertyValue","rowGap","rowSpan","Math","ceil","querySelector","getBoundingClientRect","height","gridRowEnd","position","width","transformOrigin","margin","_this4","scroll","body","scrollTop","scrollLeft","gridRect","rect","top","left","itemRect","scaleX","scaleY","_this5","set","children","get"],"mappings":"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","sourcesContent":["(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n    typeof define === 'function' && define.amd ? define('Griddie', factory) :\n    (global.Griddie = factory());\n}(this, (function () { 'use strict';\n\n    const isPromise = object => !!object && (typeof object === 'object' || typeof object === 'function') && typeof object.then === 'function';\n\n    const userAgent = navigator.userAgent.toLowerCase();\n\n    const vendorsPrefixes = ['WebKit', 'Moz', 'O', 'Ms', ''];\n\n    const MutationObserver = (() => {\n        for (let i = 0; i < vendorsPrefixes.length; i++) {\n            if (vendorsPrefixes[i] + 'MutationObserver' in window) {\n                return window[vendorsPrefixes[i] + 'MutationObserver'];\n            }\n        }\n\n        return false;\n    })();\n\n    const transitionEndEventName = (() => {\n        const el = document.createElement('div');\n\n        const transEndEventNames = {\n            WebkitTransition: 'webkitTransitionEnd',\n            MozTransition: 'transitionend',\n            OTransition: 'oTransitionEnd otransitionend',\n            msTransition: 'MSTransitionEnd',\n            transition: 'transitionend'\n        };\n\n        for (let name in transEndEventNames) {\n            if (el.style[name] !== undefined) {\n                return transEndEventNames[name];\n            }\n        }\n\n        return false;\n    })();\n\n    const getObserverId = (parent, prefix) => prefix + [...parent.classList].join('') + parent.id + 'Observer';\n\n    const disconnectObserver = (parent, mode, id) => {\n        const observerId = getObserverId(parent, id + mode);\n        if (parent[observerId]) {\n            parent[observerId].disconnect();\n            delete parent[observerId];\n        }\n    };\n\n    const setElementTimer = (element, mode, callback, time, id) => {\n        clearElementTimer(element, mode, id);\n        element[id] = window['set' + mode](callback, time);\n\n        const parent = element.parentElement;\n        const observerId = getObserverId(parent, id + mode);\n        parent[observerId] = new MutationObserver(e => {\n            if ([...e[0].removedNodes].some(el => el === element)) {\n                clearElementTimer(element, mode, id);\n                disconnectObserver(parent, mode, id);\n            }\n        });\n        parent[observerId].observe(parent, { childList: true });\n    };\n\n    const clearElementTimer = (element, mode, id, autoDisconnectObserver = false) => {\n        window['clear' + mode](element[id]);\n        delete element[id];\n\n        const parent = element.parentElement;\n        if (autoDisconnectObserver) {\n            disconnectObserver(parent, mode, id);\n        }\n    };\n\n    const attachTimeout = (element, callback = () => {}, time = 0, id = 'niteTimeout') => setElementTimer(element, 'Timeout', callback, time, id);\n\n    class Griddie {\n        constructor(options) {\n            this._options = {};\n\n            this.options = options;\n            this.layout();\n            window.addEventListener('resize', () => this.layout());\n        }\n\n        set options(options) {\n            this._options = {\n                ...{\n                    animateWidthAndHeight: true, // TODO: single item exceptions ...\n                    opacityTiming: 300,\n                    transformTiming: 300,\n                    masonry: false\n                },\n                ...options\n            };\n            this._options.transformTimingCSS = this.options.transformTiming / 1000;\n            this._options.opacityTimingCSS = this.options.opacityTiming / 1000;\n            this._options.items = [...this._options.element.children];\n        }\n\n        get options() {\n            return this._options;\n        }\n\n        animate(layoutChanges = () => {}) {\n            const animation = new Promise((resolve, reject) => {\n                const callback = () => {\n                    this.clear();\n                    this.layout(0);\n                    this.store(1);\n                    this.transform(0);\n\n                    requestAnimationFrame(() => {\n                        this._options.element.style.transition = 'height ' + this._options.transformTimingCSS + 's ease';\n                        [...this._options.items].filter(item => item.style.display !== 'none').forEach(item => {\n                            let transition = 'transform ' + this._options.transformTimingCSS + 's ease';\n                            if (this.options.animateWidthAndHeight) {\n                                transition += ', width ' + this._options.transformTimingCSS + 's ease, height ' + this._options.transformTimingCSS + 's ease';\n                            }\n\n                            item.style.transition = transition;\n                        });\n\n                        requestAnimationFrame(() => this.transform(1));\n\n                        attachTimeout(\n                            this._options.element,\n                            () => {\n                                this.clear();\n                                resolve();\n                            },\n                            this.options.transformTiming,\n                            'transform'\n                        );\n                    });\n                };\n\n                this.clear();\n                this.store(0);\n                this.transform(0);\n\n                const changes = layoutChanges();\n\n                if (isPromise(changes)) {\n                    changes.then(() => callback());\n                } else {\n                    callback();\n                }\n            });\n\n            return animation;\n        }\n\n        filter(filter = '*') {\n            const matched = this._options.items.filter(x => x.matches(filter));\n            const unmatched = this._options.items.filter(x => !x.matches(filter));\n            const hiddenMatched = matched.filter(x => x.style.display === 'none');\n            const makeRoomBeforeFade = matched.length !== hiddenMatched.length;\n            const prepareFade = () => {\n                this._options.items.forEach(item => {\n                    item.style.transition = 'opacity ' + this._options.opacityTimingCSS + 's ease';\n                });\n            };\n            const fade = () => {\n                matched.forEach(item => {\n                    item.style.opacity = 1;\n                });\n\n                unmatched.forEach(item => {\n                    item.style.opacity = 0;\n                });\n            };\n            const clearFade = () => {\n                this._options.items.forEach(item => {\n                    item.style.transition = '';\n                    item.style.opacity = '';\n                });\n\n                matched.forEach(item => {\n                    item.style.display = '';\n                });\n\n                unmatched.forEach(item => {\n                    item.style.display = 'none';\n                });\n            };\n\n            const animation = this.animate(() => {\n                const fadeAfterAnimation = new Promise((resolve, reject) => {\n                    const onFadeEnd = () => {\n                        this.store(0);\n                        this.transform(0);\n                        resolve();\n                    };\n\n                    prepareFade();\n\n                    if (hiddenMatched.length) {\n                        hiddenMatched.forEach(item => {\n                            item.style.opacity = 0;\n                        });\n                    }\n\n                    requestAnimationFrame(() => {\n                        if (hiddenMatched.length) {\n                            hiddenMatched.forEach(item => {\n                                item.style.display = '';\n                            });\n                        }\n\n                        if (hiddenMatched.length && makeRoomBeforeFade) {\n                            requestAnimationFrame(() => onFadeEnd());\n                        } else if (!hiddenMatched.length || (hiddenMatched.length && !makeRoomBeforeFade)) {\n                            requestAnimationFrame(() => {\n                                fade();\n\n                                attachTimeout(\n                                    this._options.element,\n                                    () => {\n                                        clearFade();\n\n                                        requestAnimationFrame(() => onFadeEnd());\n                                    },\n                                    this.options.opacityTiming,\n                                    'opacity'\n                                );\n                            });\n                        }\n                    });\n                });\n\n                return fadeAfterAnimation;\n            });\n\n            animation.then(() => {\n                if (makeRoomBeforeFade) {\n                    prepareFade();\n\n                    requestAnimationFrame(() => {\n                        fade();\n\n                        clearTimeout(this._filterTimeout);\n\n                        this._filterTimeout = setTimeout(() => clearFade(), this.options.opacityTiming);\n                    });\n                }\n            });\n        }\n\n        destroy() {\n            // TODO: do it\n        }\n\n        refresh() {\n            // TODO: do it\n        }\n\n        // TODO: private\n        layout() {\n            if (this._options.masonry) {\n                const rowHeight = parseInt(window.getComputedStyle(this._options.element).getPropertyValue('grid-auto-rows'));\n                const rowGap = parseInt(window.getComputedStyle(this._options.element).getPropertyValue('grid-row-gap'));\n\n                this._options.items.filter(item => item.style.display !== 'none').forEach(item => {\n                    const rowSpan = Math.ceil((item.querySelector('.content').getBoundingClientRect().height + rowGap) / (rowHeight + rowGap));\n                    item.style.gridRowEnd = 'span ' + rowSpan;\n                });\n            }\n        }\n\n        // TODO: private\n        clear() {\n            this._options.element.style.position = '';\n            this._options.element.style.width = '';\n            this._options.element.style.height = '';\n            this._options.element.style.transition = '';\n\n            this._options.items.forEach(item => {\n                item.style.transform = '';\n                item.style.transformOrigin = '';\n                item.style.position = '';\n                item.style.transition = '';\n                item.style.width = '';\n                item.style.height = '';\n                item.style.margin = '';\n            });\n        }\n\n        // TODO: private\n        store(id = 0) {\n            const scroll = {\n                top: document.body.scrollTop,\n                left: document.body.scrollLeft\n            };\n            const gridRect = this._options.element.getBoundingClientRect();\n            if (!('rect' in this._options.element)) {\n                this._options.element.rect = [];\n            }\n            this._options.element.rect[id] = {\n                width: gridRect.width,\n                height: gridRect.height,\n                top: gridRect.top + scroll.top,\n                left: gridRect.left + scroll.left\n            };\n            this._options.items.filter(item => item.style.display !== 'none').forEach(item => {\n                if (!('rect' in item)) {\n                    item.rect = [];\n                }\n                const itemRect = item.getBoundingClientRect();\n                item.rect[id] = {\n                    width: itemRect.width,\n                    height: itemRect.height,\n                    top: itemRect.top + scroll.top - this._options.element.rect[id].top,\n                    left: itemRect.left + scroll.left - this._options.element.rect[id].left,\n                    scaleX: 1,\n                    scaleY: 1\n                };\n                item.rect[id].top = item.rect[id].top >= 0 ? item.rect[id].top : 0;\n                item.rect[id].left = item.rect[id].left >= 0 ? item.rect[id].left : 0;\n                if (id === 1) {\n                    const scaleX = item.rect[0].width / itemRect.width;\n                    const scaleY = item.rect[0].height / itemRect.height;\n                    if (scaleX > 0) {\n                        item.rect[id].scaleX = 1 / scaleX;\n                    }\n                    if (scaleY > 0) {\n                        item.rect[id].scaleY = 1 / scaleY;\n                    }\n                }\n            });\n        }\n\n        // TODO: private\n        transform(id = 0) {\n            this._options.element.style.position = 'relative';\n            this._options.element.style.width = this._options.element.rect[id].width + 'px';\n            this._options.element.style.height = this._options.element.rect[id].height + 'px';\n\n            this._options.items.filter(item => item.style.display !== 'none').forEach(item => {\n                let transform = 'translate3d(' + item.rect[id].left + 'px,' + item.rect[id].top + 'px, 0px)';\n\n                if (!this.options.animateWidthAndHeight) {\n                    transform += ' scale3d(' + item.rect[id].scaleX + ', ' + item.rect[id].scaleY + ', 1)';\n                }\n\n                if (this.options.animateWidthAndHeight || id === 0) {\n                    item.style.width = item.rect[id].width + 'px';\n                    item.style.height = item.rect[id].height + 'px';\n                }\n\n                item.style.margin = 0;\n                item.style.position = 'absolute';\n                item.style.transformOrigin = '0 0 0';\n                item.style.transform = transform;\n            });\n        }\n    }\n\n    return Griddie;\n\n})));\n"],"file":"griddie.min.js"}