{"version":3,"sources":["griddie.js"],"names":["_extends","Object","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","_createClass","defineProperties","props","descriptor","enumerable","configurable","writable","defineProperty","Constructor","protoProps","staticProps","_typeof","Symbol","iterator","obj","constructor","_classCallCheck","instance","TypeError","_toConsumableArray","arr","Array","isArray","arr2","from","global","factory","exports","module","define","amd","Griddie","this","navigator","userAgent","toLowerCase","_polyfill","vendorsPrefixes","MutationObserver","window","getObserverId","el","document","createElement","transEndEventNames","WebkitTransition","MozTransition","OTransition","msTransition","transition","name","undefined","style","parent","prefix","concat","classList","join","id","disconnectObserver","mode","observerId","disconnect","clearElementTimer","element","autoDisconnectObserver","parentElement","attachTimeout","callback","time","e","removedNodes","some","observe","childList","setElementTimer","detachTimeout","stringContains","heystack","needle","String","includes","indexOf","Viewport","_window","_html","documentElement","_body","body","_frame1","_frame2","_prefix1","_prefix2","_offsetWidth","_offsetHeight","_width","_height","_scrollTop","_scrollLeft","_lock","calcAll","value","offsetWidth","offsetHeight","width","height","scrollTop","scrollLeft","calcOffsetWidth","calcOffsetHeight","calcWidth","calcHeight","calcScrollTop","calcScrollLeft","all","get","set","bool","top","left","scrollBarWidth","scrollBarHeight","position","Math","abs","parseFloat","scroll","behavior","privateEventsStorage","detachEventListener","CustomEvent","event","params","bubbles","cancelable","detail","evt","createEvent","initCustomEvent","Event","events","startsWith","substr","eventNameWithNamespace","replace","type","split","removeEventListener","handler","attachEventListener","once","count","_handler","addEventListener","options","_this","_element","_items","children","_options","_viewport","layout","_this2","layoutChanges","Promise","resolve","reject","clear","store","transform","requestAnimationFrame","transformTimingCSS","filter","item","display","forEach","scaleXY","transformTiming","object","changes","then","_this3","_filter","matched","x","matches","unmatched","hiddenMatched","makeRoomBeforeFade","prepareFade","opacityTimingCSS","fade","opacity","clearFade","animate","onFadeEnd","opacityTiming","clearTimeout","_filterTimeout","setTimeout","gridRowEnd","rect","masonry","getComputedStyle","getPropertyValue","gridTemplateColumns","rowHeight","gridAutoRows","parseInt","gridColumnGap","rowGap","gridRowGap","rowSpan","ceil","getBoundingClientRect","transformOrigin","margin","_this4","gridRect","itemRect","scaleX","scaleY","_this5"],"mappings":"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","sourcesContent":["(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n    typeof define === 'function' && define.amd ? define('Griddie', factory) :\n    (global.Griddie = factory());\n}(this, (function () { 'use strict';\n\n    const isPromise = object => !!object && (typeof object === 'object' || typeof object === 'function') && typeof object.then === 'function';\n\n    const userAgent = navigator.userAgent.toLowerCase();\n\n    const vendorsPrefixes = ['WebKit', 'Moz', 'O', 'Ms', ''];\n\n    const MutationObserver = (() => {\n        for (let i = 0; i < vendorsPrefixes.length; i++) {\n            if (vendorsPrefixes[i] + 'MutationObserver' in window) {\n                return window[vendorsPrefixes[i] + 'MutationObserver'];\n            }\n        }\n\n        return false;\n    })();\n\n    const transitionEndEventName = (() => {\n        const el = document.createElement('div');\n\n        const transEndEventNames = {\n            WebkitTransition: 'webkitTransitionEnd',\n            MozTransition: 'transitionend',\n            OTransition: 'oTransitionEnd otransitionend',\n            msTransition: 'MSTransitionEnd',\n            transition: 'transitionend'\n        };\n\n        for (let name in transEndEventNames) {\n            if (el.style[name] !== undefined) {\n                return transEndEventNames[name];\n            }\n        }\n\n        return false;\n    })();\n\n    const getObserverId = (parent, prefix) => prefix + [...parent.classList].join('') + parent.id + 'Observer';\n\n    const disconnectObserver = (parent, mode, id) => {\n        const observerId = getObserverId(parent, id + mode);\n        if (parent[observerId]) {\n            parent[observerId].disconnect();\n            delete parent[observerId];\n        }\n    };\n\n    const setElementTimer = (element, mode, callback, time, id) => {\n        clearElementTimer(element, mode, id);\n        element[id] = window['set' + mode](callback, time);\n\n        const parent = element.parentElement;\n        const observerId = getObserverId(parent, id + mode);\n        parent[observerId] = new MutationObserver(e => {\n            if ([...e[0].removedNodes].some(el => el === element)) {\n                clearElementTimer(element, mode, id);\n                disconnectObserver(parent, mode, id);\n            }\n        });\n        parent[observerId].observe(parent, { childList: true });\n    };\n\n    const clearElementTimer = (element, mode, id, autoDisconnectObserver = false) => {\n        window['clear' + mode](element[id]);\n        delete element[id];\n\n        const parent = element.parentElement;\n        if (autoDisconnectObserver) {\n            disconnectObserver(parent, mode, id);\n        }\n    };\n\n    const attachTimeout = (element, callback = () => {}, time = 0, id = 'niteTimeout') => setElementTimer(element, 'Timeout', callback, time, id);\n    const detachTimeout = (element, id = 'niteTimeout') => clearElementTimer(element, 'Timeout', id, true);\n\n    /**\n     * @param {string} prop\n     * @param {string} value\n     * @returns {boolean}\n     */\n\n    /**\n     * @param {string} heystack\n     * @param {string} needle\n     * @returns {boolean}\n     */\n    const stringContains = (heystack, needle) => {\n        return String.prototype.includes ? heystack.includes(needle) : heystack.indexOf(needle, 0) !== -1;\n    };\n\n    /**\n     * @param {string} heystack\n     * @param {string} needle\n     * @returns {boolean}\n     */\n    const stringStartsWith = (heystack, needle) => {\n        return String.prototype.startsWith ? heystack.startsWith(needle) : heystack.substr(0, needle.length) === needle;\n    };\n\n    /**\n     *\n     */\n    class Viewport {\n        constructor() {\n            this._window = window;\n            this._html = document.documentElement;\n            this._body = document.body;\n\n            this._frame1 = this._window;\n            this._frame2 = this._html || this._body;\n            this._prefix1 = 'inner';\n            this._prefix2 = 'offset';\n            if (!this._prefix1 + 'Width' in this._frame1) {\n                this._prefix1 = 'client';\n                this._frame1 = this._frame2;\n            }\n\n            this._offsetWidth = 0;\n            this._offsetHeight = 0;\n            this._width = 0;\n            this._height = 0;\n            this._scrollTop = 0;\n            this._scrollLeft = 0;\n\n            this._lock = false;\n\n            this.calcAll();\n        }\n\n        get offsetWidth() {\n            return this._offsetWidth;\n        }\n        get offsetHeight() {\n            return this._offsetHeight;\n        }\n        get width() {\n            return this._width;\n        }\n        get height() {\n            return this._height;\n        }\n        get scrollTop() {\n            return this._scrollTop;\n        }\n        get scrollLeft() {\n            return this._scrollLeft;\n        }\n        get all() {\n            return {\n                offsetWidth: this.offsetWidth,\n                offsetHeight: this.offsetHeight,\n                width: this.width,\n                height: this.height,\n                scrollTop: this.scrollTop,\n                scrollLeft: this.scrollLeft\n            };\n        }\n\n        calcOffsetWidth() {\n            this._offsetWidth = this._body[this._prefix2 + 'Width'];\n            return this.offsetWidth;\n        }\n        calcOffsetHeight() {\n            this._offsetHeight = this._body[this._prefix2 + 'Height'];\n            return this.offsetHeight;\n        }\n        calcWidth() {\n            this._width = this._frame1[this._prefix1 + 'Width'];\n            return this.width;\n        }\n        calcHeight() {\n            this._height = this._frame1[this._prefix1 + 'Height'];\n            return this.height;\n        }\n        calcScrollTop() {\n            this._scrollTop = this._frame2.scrollTop || 0;\n            return this.scrollTop;\n        }\n        calcScrollLeft() {\n            this._scrollLeft = this._frame2.scrollLeft || 0;\n            return this.scrollLeft;\n        }\n        calcAll() {\n            this.calcOffsetWidth();\n            this.calcOffsetHeight();\n            this.calcWidth();\n            this.calcHeight();\n            this.calcScrollTop();\n            this.calcScrollLeft();\n            return this.all;\n        }\n\n        get lock() {\n            return this._lock;\n        }\n\n        set lock(bool) {\n            this._lock = bool;\n\n            if (this._lock) {\n                this._body.style.top = -this.calcScrollTop() + 'px';\n                this._body.style.left = -this.calcScrollLeft() + 'px';\n\n                let scrollBarWidth = this.calcOffsetWidth();\n                let scrollBarHeight = this.calcOffsetHeight();\n\n                this._html.style.top = '0px';\n                this._html.style.left = '0px';\n                this._html.style.position = 'fixed';\n                this._body.style.position = 'fixed';\n                this._html.style.width = '100%';\n                this._body.style.width = '100%';\n\n                let offsetWidth = this.calcOffsetWidth();\n                let offsetHeight = this.calcOffsetHeight();\n                scrollBarWidth = offsetWidth - scrollBarWidth;\n                scrollBarHeight = offsetHeight - scrollBarHeight;\n\n                this._body.style.width = offsetWidth - scrollBarWidth + 'px';\n                this._body.style.height = offsetHeight - scrollBarHeight + 'px';\n            } else {\n                let scrollTop = Math.abs(parseFloat(this._body.style.top));\n                let scrollLeft = Math.abs(parseFloat(this._body.style.left));\n\n                this._html.style.position = '';\n                this._html.style.top = '';\n                this._html.style.left = '';\n                this._html.style.width = '';\n                this._body.style.position = '';\n                this._body.style.top = '';\n                this._body.style.left = '';\n                this._body.style.width = '';\n\n                this._window.scroll({\n                    top: scrollTop,\n                    left: scrollLeft,\n                    behavior: 'instant'\n                });\n            }\n        }\n    }\n\n    const eventNamespaceParserSeparator = '__namespace__';\n    let privateEventsStorage = {};\n\n    const CustomEvent =\n        window.CustomEvent ||\n        (() => {\n            const _polyfill = (event, params) => {\n                params = params || { bubbles: false, cancelable: false, detail: undefined };\n                const evt = document.createEvent('CustomEvent');\n                evt.initCustomEvent(event, params.bubbles, params.cancelable, params.detail);\n                return evt;\n            };\n            _polyfill.prototype = window.Event.prototype;\n            return _polyfill;\n        })();\n\n    /**\n     * @param {HTMLElement} element\n     * @param {string} events\n     * @returns {undefined}\n     */\n    const detachEventListener = (element, events) => {\n        if (!element || typeof events !== 'string') {\n            return;\n        }\n\n        if (stringStartsWith(events, '.')) {\n            for (let key in privateEventsStorage) {\n                const eventNameWithNamespace = key.replace(eventNamespaceParserSeparator, '.');\n                if (stringContains(eventNameWithNamespace, events) && privateEventsStorage[key].element === element) {\n                    detachEventListener(element, eventNameWithNamespace);\n                }\n            }\n        } else {\n            events = events.split('.');\n\n            const type = events[0],\n                namespace = events[1];\n\n            if (namespace) {\n                events = events.join(eventNamespaceParserSeparator);\n            }\n\n            if (events in privateEventsStorage) {\n                element.removeEventListener(type, privateEventsStorage[events].handler);\n                delete privateEventsStorage[events];\n            }\n        }\n    };\n\n    /**\n     * @param {HTMLElement} element\n     * @param {string} events\n     * @param {Function} handler\n     * @param {boolean} once\n     * @returns {undefined}\n     */\n    // TODO: Class EventListener .on .one .off .trigger jQuery-like...\n    const attachEventListener = (element, events, handler, once) => {\n        if (!element || typeof events !== 'string' || typeof handler !== 'function') {\n            return;\n        }\n\n        events = events.split('.');\n\n        const type = events[0];\n        const namespace = events[1];\n\n        if (namespace) {\n            events = events.join(eventNamespaceParserSeparator);\n        }\n\n        privateEventsStorage[events] = { element: element, count: 0, once: false };\n\n        if (true === once) {\n            let _handler = handler;\n            handler = function(event) {\n                if (events in privateEventsStorage) {\n                    privateEventsStorage[events].count++;\n                    if (privateEventsStorage[events].once && privateEventsStorage[events].count > 1) {\n                        return;\n                    }\n                    _handler.call(this, event);\n                }\n                detachEventListener(element, events);\n            };\n        } else {\n            once = false;\n        }\n\n        privateEventsStorage[events] = {\n            ...privateEventsStorage[events],\n            ...{ handler: handler, once: once }\n        };\n\n        element.addEventListener(type, privateEventsStorage[events].handler, { once: once });\n    };\n\n    class Griddie {\n        constructor(element, options) {\n            this._element = element;\n            this._items = [...this._element.children];\n            this._options = {};\n            this._viewport = new Viewport();\n\n            this._element.instance = this;\n\n            this.options = options;\n            this.layout();\n            attachEventListener(window, 'resize.griddie', () => this.layout());\n        }\n\n        set options(options) {\n            this._options = {\n                ...{\n                    scaleXY: false, // TODO: single item exceptions ...\n                    opacityTiming: 300,\n                    transformTiming: 300,\n                    masonry: false\n                },\n                ...options\n            };\n            this._options.transformTimingCSS = this.options.transformTiming / 1000;\n            this._options.opacityTimingCSS = this.options.opacityTiming / 1000;\n        }\n\n        get options() {\n            return this._options;\n        }\n\n        animate(layoutChanges = () => {}) {\n            if (!('instance' in this._element)) {\n                return;\n            }\n\n            const animation = new Promise((resolve, reject) => {\n                const callback = () => {\n                    this.clear();\n                    this.layout(0);\n                    this.store(1);\n                    this.transform(0);\n\n                    requestAnimationFrame(() => {\n                        this._element.style.transition = 'height ' + this._options.transformTimingCSS + 's ease';\n\n                        [...this._items].filter(item => item.style.display !== 'none').forEach(item => {\n                            let transition = 'transform ' + this._options.transformTimingCSS + 's ease';\n                            if (!this.options.scaleXY) {\n                                transition += ', width ' + this._options.transformTimingCSS + 's ease, height ' + this._options.transformTimingCSS + 's ease';\n                            }\n\n                            item.style.transition = transition;\n                        });\n\n                        requestAnimationFrame(() => this.transform(1));\n\n                        attachTimeout(\n                            this._element,\n                            () => {\n                                this.clear();\n                                resolve();\n                            },\n                            this.options.transformTiming,\n                            'transform'\n                        );\n                    });\n                };\n\n                detachTimeout(this._element, 'transform');\n\n                this.clear();\n                this.store(0);\n                this.transform(0);\n\n                const changes = layoutChanges();\n\n                if (isPromise(changes)) {\n                    changes.then(() => callback());\n                } else {\n                    callback();\n                }\n            });\n\n            return animation;\n        }\n\n        filter(filter = '*') {\n            if (!('instance' in this._element)) {\n                return;\n            }\n\n            const matched = this._items.filter(x => x.matches(filter));\n            const unmatched = this._items.filter(x => !x.matches(filter));\n            const hiddenMatched = matched.filter(x => x.style.display === 'none');\n            const makeRoomBeforeFade = matched.length !== hiddenMatched.length;\n\n            const prepareFade = () => {\n                this._items.forEach(item => {\n                    item.style.transition = 'opacity ' + this._options.opacityTimingCSS + 's ease';\n                });\n            };\n            const fade = () => {\n                matched.forEach(item => {\n                    item.style.opacity = 1;\n                });\n\n                unmatched.forEach(item => {\n                    item.style.opacity = 0;\n                });\n            };\n            const clearFade = () => {\n                this._items.forEach(item => {\n                    item.style.transition = '';\n                    item.style.opacity = '';\n                });\n\n                matched.forEach(item => {\n                    item.style.display = '';\n                });\n\n                unmatched.forEach(item => {\n                    item.style.display = 'none';\n                });\n            };\n\n            const animation = this.animate(() => {\n                detachTimeout(this._element, 'opacity');\n\n                const fadeAfterAnimation = new Promise((resolve, reject) => {\n                    const onFadeEnd = () => {\n                        this.store(0);\n                        this.transform(0);\n                        resolve();\n                    };\n\n                    prepareFade();\n\n                    if (hiddenMatched.length) {\n                        hiddenMatched.forEach(item => {\n                            item.style.opacity = 0;\n                        });\n                    }\n\n                    requestAnimationFrame(() => {\n                        if (hiddenMatched.length) {\n                            hiddenMatched.forEach(item => {\n                                item.style.display = '';\n                            });\n                        }\n\n                        if (hiddenMatched.length && makeRoomBeforeFade) {\n                            requestAnimationFrame(() => onFadeEnd());\n                        } else if (!hiddenMatched.length || (hiddenMatched.length && !makeRoomBeforeFade)) {\n                            requestAnimationFrame(() => {\n                                fade();\n\n                                attachTimeout(\n                                    this._element,\n                                    () => {\n                                        clearFade();\n\n                                        requestAnimationFrame(() => onFadeEnd());\n                                    },\n                                    this.options.opacityTiming,\n                                    'opacity'\n                                );\n                            });\n                        }\n                    });\n                });\n\n                return fadeAfterAnimation;\n            });\n\n            animation.then(() => {\n                if (makeRoomBeforeFade) {\n                    prepareFade();\n\n                    requestAnimationFrame(() => {\n                        fade();\n\n                        clearTimeout(this._filterTimeout);\n\n                        this._filterTimeout = setTimeout(() => clearFade(), this.options.opacityTiming);\n                    });\n                }\n            });\n        }\n\n        destroy() {\n            this.clear();\n            this._items.forEach(item => {\n                item.style.gridRowEnd = ''; // TODO: possibly in clear()?\n                item.style.display = ''; // TODO: possibly in clear()?\n                delete item.rect;\n            });\n            delete this._element.rect;\n            detachTimeout(this._element, 'transform');\n            detachTimeout(this._element, 'opacity');\n            detachEventListener(window, 'resize.griddie');\n            delete this._element.instance;\n        }\n\n        refresh() {\n            if (!('instance' in this._element)) {\n                return;\n            }\n            // TODO: do it\n        }\n\n        // TODO: private\n        layout() {\n            if (!('instance' in this._element)) {\n                return;\n            }\n\n            if (this._options.masonry) {\n                if (window.getComputedStyle(this._element).getPropertyValue('grid-template-columns') === 'none') {\n                    this._element.style.gridTemplateColumns = 'repeat(auto-fill, minmax(250px, 1fr))';\n                }\n\n                if (window.getComputedStyle(this._element).getPropertyValue('display') !== 'grid') {\n                    this._element.style.display = 'grid';\n                }\n\n                let rowHeight = window.getComputedStyle(this._element).getPropertyValue('grid-auto-rows');\n                if (rowHeight === 'auto') {\n                    rowHeight = this._element.style.gridAutoRows = '20px';\n                }\n                rowHeight = parseInt(rowHeight);\n\n                if (window.getComputedStyle(this._element).getPropertyValue('grid-column-gap') === 'normal') {\n                    this._element.style.gridColumnGap = '0px';\n                }\n\n                let rowGap = window.getComputedStyle(this._element).getPropertyValue('grid-row-gap');\n                if (rowGap === 'normal') {\n                    rowGap = this._element.style.gridRowGap = '0px';\n                }\n                rowGap = parseInt(rowGap);\n\n                this._items.filter(item => item.style.display !== 'none').forEach(item => {\n                    const rowSpan = Math.ceil(([...item.children][0].getBoundingClientRect().height + rowGap) / (rowHeight + rowGap));\n                    item.style.gridRowEnd = 'span ' + rowSpan;\n                });\n            } else {\n                this._element.style.gridTemplateColumns = '';\n                this._element.style.display = '';\n                this._element.style.gridAutoRows = '';\n                this._element.style.gridColumnGap = '';\n                this._element.style.gridRowGap = '';\n                this._items.filter(item => item.style.display !== 'none').forEach(item => {\n                    item.style.gridRowEnd = '';\n                });\n            }\n        }\n\n        // TODO: private\n        clear() {\n            if (!('instance' in this._element)) {\n                return;\n            }\n\n            this._element.style.position = '';\n            this._element.style.width = '';\n            this._element.style.height = '';\n            this._element.style.transition = '';\n\n            this._items.forEach(item => {\n                item.style.transform = '';\n                item.style.transformOrigin = '';\n                item.style.position = '';\n                item.style.transition = '';\n                item.style.width = '';\n                item.style.height = '';\n                item.style.margin = '';\n            });\n        }\n\n        // TODO: private\n        store(id = 0) {\n            if (!('instance' in this._element)) {\n                return;\n            }\n\n            this._viewport.calcScrollTop();\n            this._viewport.calcScrollLeft();\n\n            const gridRect = this._element.getBoundingClientRect();\n            if (!('rect' in this._element)) {\n                this._element.rect = [];\n            }\n\n            this._element.rect[id] = {\n                width: gridRect.width,\n                height: gridRect.height,\n                top: gridRect.top + this._viewport.scrollTop,\n                left: gridRect.left + this._viewport.scrollLeft\n            };\n\n            this._items.filter(item => item.style.display !== 'none').forEach(item => {\n                if (!('rect' in item)) {\n                    item.rect = [];\n                }\n\n                const itemRect = item.getBoundingClientRect();\n                item.rect[id] = {\n                    width: itemRect.width,\n                    height: itemRect.height,\n                    top: itemRect.top + this._viewport.scrollTop - this._element.rect[id].top,\n                    left: itemRect.left + this._viewport.scrollLeft - this._element.rect[id].left,\n                    scaleX: 1,\n                    scaleY: 1\n                };\n\n                item.rect[id].top = item.rect[id].top >= 0 ? item.rect[id].top : 0;\n                item.rect[id].left = item.rect[id].left >= 0 ? item.rect[id].left : 0;\n\n                if (id === 1) {\n                    const scaleX = item.rect[0].width / itemRect.width;\n                    const scaleY = item.rect[0].height / itemRect.height;\n\n                    if (scaleX > 0) {\n                        item.rect[id].scaleX = 1 / scaleX;\n                    }\n\n                    if (scaleY > 0) {\n                        item.rect[id].scaleY = 1 / scaleY;\n                    }\n                }\n            });\n        }\n\n        // TODO: private\n        transform(id = 0) {\n            if (!('instance' in this._element)) {\n                return;\n            }\n\n            this._element.style.position = 'relative';\n            this._element.style.width = this._element.rect[id].width + 'px';\n            this._element.style.height = this._element.rect[id].height + 'px';\n\n            this._items.filter(item => item.style.display !== 'none').forEach(item => {\n                let transform = 'translate3d(' + item.rect[id].left + 'px,' + item.rect[id].top + 'px, 0px)';\n\n                if (this.options.scaleXY) {\n                    transform += ' scale3d(' + item.rect[id].scaleX + ', ' + item.rect[id].scaleY + ', 1)';\n                }\n\n                if (!this.options.scaleXY || id === 0) {\n                    item.style.width = item.rect[id].width + 'px';\n                    item.style.height = item.rect[id].height + 'px';\n                }\n\n                item.style.margin = 0;\n                item.style.position = 'absolute';\n                item.style.transformOrigin = '0 0 0';\n                item.style.transform = transform;\n            });\n        }\n    }\n\n    return Griddie;\n\n})));\n"],"file":"griddie.min.js"}