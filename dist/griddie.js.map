{"version":3,"sources":["griddie.js"],"names":["global","factory","exports","module","define","amd","Griddie","isPromise","object","then","userAgent","navigator","toLowerCase","vendorsPrefixes","MutationObserver","i","length","window","transitionEndEventName","el","document","createElement","transEndEventNames","WebkitTransition","MozTransition","OTransition","msTransition","transition","name","style","undefined","getObserverId","parent","prefix","classList","join","id","disconnectObserver","mode","observerId","disconnect","setElementTimer","element","callback","time","clearElementTimer","parentElement","e","removedNodes","some","observe","childList","autoDisconnectObserver","attachTimeout","Viewport","_window","_html","documentElement","_body","body","_frame1","_frame2","_prefix1","_prefix2","_offsetWidth","_offsetHeight","_width","_height","_scrollTop","_scrollLeft","_lock","calcAll","offsetWidth","offsetHeight","width","height","scrollTop","scrollLeft","calcOffsetWidth","calcOffsetHeight","calcWidth","calcHeight","calcScrollTop","calcScrollLeft","all","bool","top","left","scrollBarWidth","scrollBarHeight","position","Math","abs","parseFloat","scroll","behavior","options","_options","_viewport","layout","addEventListener","layoutChanges","animation","Promise","resolve","reject","clear","store","transform","requestAnimationFrame","transformTimingCSS","items","filter","item","display","forEach","scaleXY","transformTiming","changes","matched","x","matches","unmatched","hiddenMatched","makeRoomBeforeFade","prepareFade","opacityTimingCSS","fade","opacity","clearFade","animate","fadeAfterAnimation","onFadeEnd","opacityTiming","clearTimeout","_filterTimeout","setTimeout","masonry","rowHeight","parseInt","getComputedStyle","getPropertyValue","rowGap","rowSpan","ceil","querySelector","getBoundingClientRect","gridRowEnd","transformOrigin","margin","gridRect","rect","itemRect","scaleX","scaleY","children"],"mappings":"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","file":"griddie.js","sourcesContent":["(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n    typeof define === 'function' && define.amd ? define('Griddie', factory) :\n    (global.Griddie = factory());\n}(this, (function () { 'use strict';\n\n    const isPromise = object => !!object && (typeof object === 'object' || typeof object === 'function') && typeof object.then === 'function';\n\n    const userAgent = navigator.userAgent.toLowerCase();\r\n\r\n    const vendorsPrefixes = ['WebKit', 'Moz', 'O', 'Ms', ''];\r\n\r\n    const MutationObserver = (() => {\r\n        for (let i = 0; i < vendorsPrefixes.length; i++) {\r\n            if (vendorsPrefixes[i] + 'MutationObserver' in window) {\r\n                return window[vendorsPrefixes[i] + 'MutationObserver'];\r\n            }\r\n        }\r\n\r\n        return false;\r\n    })();\r\n\r\n    const transitionEndEventName = (() => {\r\n        const el = document.createElement('div');\r\n\r\n        const transEndEventNames = {\r\n            WebkitTransition: 'webkitTransitionEnd',\r\n            MozTransition: 'transitionend',\r\n            OTransition: 'oTransitionEnd otransitionend',\r\n            msTransition: 'MSTransitionEnd',\r\n            transition: 'transitionend'\r\n        };\r\n\r\n        for (let name in transEndEventNames) {\r\n            if (el.style[name] !== undefined) {\r\n                return transEndEventNames[name];\r\n            }\r\n        }\r\n\r\n        return false;\r\n    })();\n\n    const getObserverId = (parent, prefix) => prefix + [...parent.classList].join('') + parent.id + 'Observer';\r\n\r\n    const disconnectObserver = (parent, mode, id) => {\r\n        const observerId = getObserverId(parent, id + mode);\r\n        if (parent[observerId]) {\r\n            parent[observerId].disconnect();\r\n            delete parent[observerId];\r\n        }\r\n    };\r\n\r\n    const setElementTimer = (element, mode, callback, time, id) => {\r\n        clearElementTimer(element, mode, id);\r\n        element[id] = window['set' + mode](callback, time);\r\n\r\n        const parent = element.parentElement;\r\n        const observerId = getObserverId(parent, id + mode);\r\n        parent[observerId] = new MutationObserver(e => {\r\n            if ([...e[0].removedNodes].some(el => el === element)) {\r\n                clearElementTimer(element, mode, id);\r\n                disconnectObserver(parent, mode, id);\r\n            }\r\n        });\r\n        parent[observerId].observe(parent, { childList: true });\r\n    };\r\n\r\n    const clearElementTimer = (element, mode, id, autoDisconnectObserver = false) => {\r\n        window['clear' + mode](element[id]);\r\n        delete element[id];\r\n\r\n        const parent = element.parentElement;\r\n        if (autoDisconnectObserver) {\r\n            disconnectObserver(parent, mode, id);\r\n        }\r\n    };\r\n\r\n    const attachTimeout = (element, callback = () => {}, time = 0, id = 'niteTimeout') => setElementTimer(element, 'Timeout', callback, time, id);\n\n    /**\r\n     * @param {string} prop\r\n     * @param {string} value\r\n     * @returns {boolean}\r\n     */\n\n    /**\r\n     *\r\n     */\r\n    class Viewport {\r\n        constructor() {\r\n            this._window = window;\r\n            this._html = document.documentElement;\r\n            this._body = document.body;\r\n\r\n            this._frame1 = this._window;\r\n            this._frame2 = this._html || this._body;\r\n            this._prefix1 = 'inner';\r\n            this._prefix2 = 'offset';\r\n            if (!this._prefix1 + 'Width' in this._frame1) {\r\n                this._prefix1 = 'client';\r\n                this._frame1 = this._frame2;\r\n            }\r\n\r\n            this._offsetWidth = 0;\r\n            this._offsetHeight = 0;\r\n            this._width = 0;\r\n            this._height = 0;\r\n            this._scrollTop = 0;\r\n            this._scrollLeft = 0;\r\n\r\n            this._lock = false;\r\n\r\n            this.calcAll();\r\n        }\r\n\r\n        get offsetWidth() {\r\n            return this._offsetWidth;\r\n        }\r\n        get offsetHeight() {\r\n            return this._offsetHeight;\r\n        }\r\n        get width() {\r\n            return this._width;\r\n        }\r\n        get height() {\r\n            return this._height;\r\n        }\r\n        get scrollTop() {\r\n            return this._scrollTop;\r\n        }\r\n        get scrollLeft() {\r\n            return this._scrollLeft;\r\n        }\r\n        get all() {\r\n            return {\r\n                offsetWidth: this.offsetWidth,\r\n                offsetHeight: this.offsetHeight,\r\n                width: this.width,\r\n                height: this.height,\r\n                scrollTop: this.scrollTop,\r\n                scrollLeft: this.scrollLeft\r\n            };\r\n        }\r\n\r\n        calcOffsetWidth() {\r\n            this._offsetWidth = this._body[this._prefix2 + 'Width'];\r\n            return this.offsetWidth;\r\n        }\r\n        calcOffsetHeight() {\r\n            this._offsetHeight = this._body[this._prefix2 + 'Height'];\r\n            return this.offsetHeight;\r\n        }\r\n        calcWidth() {\r\n            this._width = this._frame1[this._prefix1 + 'Width'];\r\n            return this.width;\r\n        }\r\n        calcHeight() {\r\n            this._height = this._frame1[this._prefix1 + 'Height'];\r\n            return this.height;\r\n        }\r\n        calcScrollTop() {\r\n            this._scrollTop = this._frame2.scrollTop || 0;\r\n            return this.scrollTop;\r\n        }\r\n        calcScrollLeft() {\r\n            this._scrollLeft = this._frame2.scrollLeft || 0;\r\n            return this.scrollLeft;\r\n        }\r\n        calcAll() {\r\n            this.calcOffsetWidth();\r\n            this.calcOffsetHeight();\r\n            this.calcWidth();\r\n            this.calcHeight();\r\n            this.calcScrollTop();\r\n            this.calcScrollLeft();\r\n            return this.all;\r\n        }\r\n\r\n        get lock() {\r\n            return this._lock;\r\n        }\r\n\r\n        set lock(bool) {\r\n            this._lock = bool;\r\n\r\n            if (this._lock) {\r\n                this._body.style.top = -this.calcScrollTop() + 'px';\r\n                this._body.style.left = -this.calcScrollLeft() + 'px';\r\n\r\n                let scrollBarWidth = this.calcOffsetWidth();\r\n                let scrollBarHeight = this.calcOffsetHeight();\r\n\r\n                this._html.style.top = '0px';\r\n                this._html.style.left = '0px';\r\n                this._html.style.position = 'fixed';\r\n                this._body.style.position = 'fixed';\r\n                this._html.style.width = '100%';\r\n                this._body.style.width = '100%';\r\n\r\n                let offsetWidth = this.calcOffsetWidth();\r\n                let offsetHeight = this.calcOffsetHeight();\r\n                scrollBarWidth = offsetWidth - scrollBarWidth;\r\n                scrollBarHeight = offsetHeight - scrollBarHeight;\r\n\r\n                this._body.style.width = offsetWidth - scrollBarWidth + 'px';\r\n                this._body.style.height = offsetHeight - scrollBarHeight + 'px';\r\n            } else {\r\n                let scrollTop = Math.abs(parseFloat(this._body.style.top));\r\n                let scrollLeft = Math.abs(parseFloat(this._body.style.left));\r\n\r\n                this._html.style.position = '';\r\n                this._html.style.top = '';\r\n                this._html.style.left = '';\r\n                this._html.style.width = '';\r\n                this._body.style.position = '';\r\n                this._body.style.top = '';\r\n                this._body.style.left = '';\r\n                this._body.style.width = '';\r\n\r\n                this._window.scroll({\r\n                    top: scrollTop,\r\n                    left: scrollLeft,\r\n                    behavior: 'instant'\r\n                });\r\n            }\r\n        }\r\n    }\n\n    class Griddie {\r\n        constructor(options) {\r\n            this._options = {};\r\n            this.options = options;\r\n            this._viewport = new Viewport();\r\n            this.layout();\r\n            window.addEventListener('resize', () => this.layout());\r\n        }\r\n\r\n        set options(options) {\r\n            this._options = {\r\n                ...{\r\n                    scaleXY: false, // TODO: single item exceptions ...\r\n                    opacityTiming: 300,\r\n                    transformTiming: 300,\r\n                    masonry: false\r\n                },\r\n                ...options\r\n            };\r\n            this._options.transformTimingCSS = this.options.transformTiming / 1000;\r\n            this._options.opacityTimingCSS = this.options.opacityTiming / 1000;\r\n            this._options.items = [...this._options.element.children];\r\n        }\r\n\r\n        get options() {\r\n            return this._options;\r\n        }\r\n\r\n        animate(layoutChanges = () => {}) {\r\n            const animation = new Promise((resolve, reject) => {\r\n                const callback = () => {\r\n                    this.clear();\r\n                    this.layout(0);\r\n                    this.store(1);\r\n                    this.transform(0);\r\n\r\n                    requestAnimationFrame(() => {\r\n                        this._options.element.style.transition = 'height ' + this._options.transformTimingCSS + 's ease';\r\n                        [...this._options.items].filter(item => item.style.display !== 'none').forEach(item => {\r\n                            let transition = 'transform ' + this._options.transformTimingCSS + 's ease';\r\n                            if (!this.options.scaleXY) {\r\n                                transition += ', width ' + this._options.transformTimingCSS + 's ease, height ' + this._options.transformTimingCSS + 's ease';\r\n                            }\r\n\r\n                            item.style.transition = transition;\r\n                        });\r\n\r\n                        requestAnimationFrame(() => this.transform(1));\r\n\r\n                        attachTimeout(\r\n                            this._options.element,\r\n                            () => {\r\n                                this.clear();\r\n                                resolve();\r\n                            },\r\n                            this.options.transformTiming,\r\n                            'transform'\r\n                        );\r\n                    });\r\n                };\r\n\r\n                this.clear();\r\n                this.store(0);\r\n                this.transform(0);\r\n\r\n                const changes = layoutChanges();\r\n\r\n                if (isPromise(changes)) {\r\n                    changes.then(() => callback());\r\n                } else {\r\n                    callback();\r\n                }\r\n            });\r\n\r\n            return animation;\r\n        }\r\n\r\n        filter(filter = '*') {\r\n            const matched = this._options.items.filter(x => x.matches(filter));\r\n            const unmatched = this._options.items.filter(x => !x.matches(filter));\r\n            const hiddenMatched = matched.filter(x => x.style.display === 'none');\r\n            const makeRoomBeforeFade = matched.length !== hiddenMatched.length;\r\n            const prepareFade = () => {\r\n                this._options.items.forEach(item => {\r\n                    item.style.transition = 'opacity ' + this._options.opacityTimingCSS + 's ease';\r\n                });\r\n            };\r\n\r\n            const fade = () => {\r\n                matched.forEach(item => {\r\n                    item.style.opacity = 1;\r\n                });\r\n\r\n                unmatched.forEach(item => {\r\n                    item.style.opacity = 0;\r\n                });\r\n            };\r\n\r\n            const clearFade = () => {\r\n                this._options.items.forEach(item => {\r\n                    item.style.transition = '';\r\n                    item.style.opacity = '';\r\n                });\r\n\r\n                matched.forEach(item => {\r\n                    item.style.display = '';\r\n                });\r\n\r\n                unmatched.forEach(item => {\r\n                    item.style.display = 'none';\r\n                });\r\n            };\r\n\r\n            const animation = this.animate(() => {\r\n                const fadeAfterAnimation = new Promise((resolve, reject) => {\r\n                    const onFadeEnd = () => {\r\n                        this.store(0);\r\n                        this.transform(0);\r\n                        resolve();\r\n                    };\r\n\r\n                    prepareFade();\r\n\r\n                    if (hiddenMatched.length) {\r\n                        hiddenMatched.forEach(item => {\r\n                            item.style.opacity = 0;\r\n                        });\r\n                    }\r\n\r\n                    requestAnimationFrame(() => {\r\n                        if (hiddenMatched.length) {\r\n                            hiddenMatched.forEach(item => {\r\n                                item.style.display = '';\r\n                            });\r\n                        }\r\n\r\n                        if (hiddenMatched.length && makeRoomBeforeFade) {\r\n                            requestAnimationFrame(() => onFadeEnd());\r\n                        } else if (!hiddenMatched.length || (hiddenMatched.length && !makeRoomBeforeFade)) {\r\n                            requestAnimationFrame(() => {\r\n                                fade();\r\n\r\n                                attachTimeout(\r\n                                    this._options.element,\r\n                                    () => {\r\n                                        clearFade();\r\n\r\n                                        requestAnimationFrame(() => onFadeEnd());\r\n                                    },\r\n                                    this.options.opacityTiming,\r\n                                    'opacity'\r\n                                );\r\n                            });\r\n                        }\r\n                    });\r\n                });\r\n\r\n                return fadeAfterAnimation;\r\n            });\r\n\r\n            animation.then(() => {\r\n                if (makeRoomBeforeFade) {\r\n                    prepareFade();\r\n\r\n                    requestAnimationFrame(() => {\r\n                        fade();\r\n\r\n                        clearTimeout(this._filterTimeout);\r\n\r\n                        this._filterTimeout = setTimeout(() => clearFade(), this.options.opacityTiming);\r\n                    });\r\n                }\r\n            });\r\n        }\r\n\r\n        destroy() {\r\n            // TODO: do it\r\n        }\r\n\r\n        refresh() {\r\n            // TODO: do it\r\n        }\r\n\r\n        // TODO: private\r\n        layout() {\r\n            if (this._options.masonry) {\r\n                const rowHeight = parseInt(window.getComputedStyle(this._options.element).getPropertyValue('grid-auto-rows'));\r\n                const rowGap = parseInt(window.getComputedStyle(this._options.element).getPropertyValue('grid-row-gap'));\r\n\r\n                this._options.items.filter(item => item.style.display !== 'none').forEach(item => {\r\n                    const rowSpan = Math.ceil((item.querySelector('.content').getBoundingClientRect().height + rowGap) / (rowHeight + rowGap));\r\n                    item.style.gridRowEnd = 'span ' + rowSpan;\r\n                });\r\n            }\r\n        }\r\n\r\n        // TODO: private\r\n        clear() {\r\n            this._options.element.style.position = '';\r\n            this._options.element.style.width = '';\r\n            this._options.element.style.height = '';\r\n            this._options.element.style.transition = '';\r\n\r\n            this._options.items.forEach(item => {\r\n                item.style.transform = '';\r\n                item.style.transformOrigin = '';\r\n                item.style.position = '';\r\n                item.style.transition = '';\r\n                item.style.width = '';\r\n                item.style.height = '';\r\n                item.style.margin = '';\r\n            });\r\n        }\r\n\r\n        // TODO: private\r\n        store(id = 0) {\r\n            this._viewport.calcScrollTop();\r\n            this._viewport.calcScrollLeft();\r\n\r\n            const gridRect = this._options.element.getBoundingClientRect();\r\n            if (!('rect' in this._options.element)) {\r\n                this._options.element.rect = [];\r\n            }\r\n\r\n            this._options.element.rect[id] = {\r\n                width: gridRect.width,\r\n                height: gridRect.height,\r\n                top: gridRect.top + this._viewport.scrollTop,\r\n                left: gridRect.left + this._viewport.scrollLeft\r\n            };\r\n\r\n            this._options.items.filter(item => item.style.display !== 'none').forEach(item => {\r\n                if (!('rect' in item)) {\r\n                    item.rect = [];\r\n                }\r\n\r\n                const itemRect = item.getBoundingClientRect();\r\n                item.rect[id] = {\r\n                    width: itemRect.width,\r\n                    height: itemRect.height,\r\n                    top: itemRect.top + this._viewport.scrollTop - this._options.element.rect[id].top,\r\n                    left: itemRect.left + this._viewport.scrollLeft - this._options.element.rect[id].left,\r\n                    scaleX: 1,\r\n                    scaleY: 1\r\n                };\r\n\r\n                item.rect[id].top = item.rect[id].top >= 0 ? item.rect[id].top : 0;\r\n                item.rect[id].left = item.rect[id].left >= 0 ? item.rect[id].left : 0;\r\n\r\n                if (id === 1) {\r\n                    const scaleX = item.rect[0].width / itemRect.width;\r\n                    const scaleY = item.rect[0].height / itemRect.height;\r\n\r\n                    if (scaleX > 0) {\r\n                        item.rect[id].scaleX = 1 / scaleX;\r\n                    }\r\n\r\n                    if (scaleY > 0) {\r\n                        item.rect[id].scaleY = 1 / scaleY;\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        // TODO: private\r\n        transform(id = 0) {\r\n            this._options.element.style.position = 'relative';\r\n            this._options.element.style.width = this._options.element.rect[id].width + 'px';\r\n            this._options.element.style.height = this._options.element.rect[id].height + 'px';\r\n\r\n            this._options.items.filter(item => item.style.display !== 'none').forEach(item => {\r\n                let transform = 'translate3d(' + item.rect[id].left + 'px,' + item.rect[id].top + 'px, 0px)';\r\n\r\n                if (this.options.scaleXY) {\r\n                    transform += ' scale3d(' + item.rect[id].scaleX + ', ' + item.rect[id].scaleY + ', 1)';\r\n                }\r\n\r\n                if (!this.options.scaleXY || id === 0) {\r\n                    item.style.width = item.rect[id].width + 'px';\r\n                    item.style.height = item.rect[id].height + 'px';\r\n                }\r\n\r\n                item.style.margin = 0;\r\n                item.style.position = 'absolute';\r\n                item.style.transformOrigin = '0 0 0';\r\n                item.style.transform = transform;\r\n            });\r\n        }\r\n    }\n\n    return Griddie;\n\n})));\n"]}