{"version":3,"sources":["griddie.js"],"names":["global","factory","exports","module","define","amd","Griddie","isPromise","object","then","userAgent","navigator","toLowerCase","vendorsPrefixes","MutationObserver","i","length","window","transitionEndEventName","el","document","createElement","transEndEventNames","WebkitTransition","MozTransition","OTransition","msTransition","transition","name","style","undefined","getObserverId","parent","prefix","classList","join","id","disconnectObserver","mode","observerId","disconnect","setElementTimer","element","callback","time","clearElementTimer","parentElement","e","removedNodes","some","observe","childList","autoDisconnectObserver","attachTimeout","options","_options","layout","addEventListener","layoutChanges","animation","Promise","resolve","reject","clear","store","transform","requestAnimationFrame","transformTimingCSS","items","filter","item","display","forEach","animateWidthAndHeight","transformTiming","changes","matched","x","matches","unmatched","hiddenMatched","makeRoomBeforeFade","prepareFade","opacityTimingCSS","fade","opacity","clearFade","animate","fadeAfterAnimation","onFadeEnd","opacityTiming","clearTimeout","_filterTimeout","setTimeout","masonry","rowHeight","parseInt","getComputedStyle","getPropertyValue","rowGap","rowSpan","Math","ceil","querySelector","getBoundingClientRect","height","gridRowEnd","position","width","transformOrigin","margin","scroll","top","body","scrollTop","left","scrollLeft","gridRect","rect","itemRect","scaleX","scaleY","children"],"mappings":"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","file":"griddie.js","sourcesContent":["(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n    typeof define === 'function' && define.amd ? define('Griddie', factory) :\n    (global.Griddie = factory());\n}(this, (function () { 'use strict';\n\n    const isPromise = object => !!object && (typeof object === 'object' || typeof object === 'function') && typeof object.then === 'function';\n\n    const userAgent = navigator.userAgent.toLowerCase();\n\n    const vendorsPrefixes = ['WebKit', 'Moz', 'O', 'Ms', ''];\n\n    const MutationObserver = (() => {\n        for (let i = 0; i < vendorsPrefixes.length; i++) {\n            if (vendorsPrefixes[i] + 'MutationObserver' in window) {\n                return window[vendorsPrefixes[i] + 'MutationObserver'];\n            }\n        }\n\n        return false;\n    })();\n\n    const transitionEndEventName = (() => {\n        const el = document.createElement('div');\n\n        const transEndEventNames = {\n            WebkitTransition: 'webkitTransitionEnd',\n            MozTransition: 'transitionend',\n            OTransition: 'oTransitionEnd otransitionend',\n            msTransition: 'MSTransitionEnd',\n            transition: 'transitionend'\n        };\n\n        for (let name in transEndEventNames) {\n            if (el.style[name] !== undefined) {\n                return transEndEventNames[name];\n            }\n        }\n\n        return false;\n    })();\n\n    const getObserverId = (parent, prefix) => prefix + [...parent.classList].join('') + parent.id + 'Observer';\n\n    const disconnectObserver = (parent, mode, id) => {\n        const observerId = getObserverId(parent, id + mode);\n        if (parent[observerId]) {\n            parent[observerId].disconnect();\n            delete parent[observerId];\n        }\n    };\n\n    const setElementTimer = (element, mode, callback, time, id) => {\n        clearElementTimer(element, mode, id);\n        element[id] = window['set' + mode](callback, time);\n\n        const parent = element.parentElement;\n        const observerId = getObserverId(parent, id + mode);\n        parent[observerId] = new MutationObserver(e => {\n            if ([...e[0].removedNodes].some(el => el === element)) {\n                clearElementTimer(element, mode, id);\n                disconnectObserver(parent, mode, id);\n            }\n        });\n        parent[observerId].observe(parent, { childList: true });\n    };\n\n    const clearElementTimer = (element, mode, id, autoDisconnectObserver = false) => {\n        window['clear' + mode](element[id]);\n        delete element[id];\n\n        const parent = element.parentElement;\n        if (autoDisconnectObserver) {\n            disconnectObserver(parent, mode, id);\n        }\n    };\n\n    const attachTimeout = (element, callback = () => {}, time = 0, id = 'niteTimeout') => setElementTimer(element, 'Timeout', callback, time, id);\n\n    class Griddie {\n        constructor(options) {\n            this._options = {};\n\n            this.options = options;\n            this.layout();\n            window.addEventListener('resize', () => this.layout());\n        }\n\n        set options(options) {\n            this._options = {\n                ...{\n                    animateWidthAndHeight: true, // TODO: single item exceptions ...\n                    opacityTiming: 300,\n                    transformTiming: 300,\n                    masonry: false\n                },\n                ...options\n            };\n            this._options.transformTimingCSS = this.options.transformTiming / 1000;\n            this._options.opacityTimingCSS = this.options.opacityTiming / 1000;\n            this._options.items = [...this._options.element.children];\n        }\n\n        get options() {\n            return this._options;\n        }\n\n        animate(layoutChanges = () => {}) {\n            const animation = new Promise((resolve, reject) => {\n                const callback = () => {\n                    this.clear();\n                    this.layout(0);\n                    this.store(1);\n                    this.transform(0);\n\n                    requestAnimationFrame(() => {\n                        this._options.element.style.transition = 'height ' + this._options.transformTimingCSS + 's ease';\n                        [...this._options.items].filter(item => item.style.display !== 'none').forEach(item => {\n                            let transition = 'transform ' + this._options.transformTimingCSS + 's ease';\n                            if (this.options.animateWidthAndHeight) {\n                                transition += ', width ' + this._options.transformTimingCSS + 's ease, height ' + this._options.transformTimingCSS + 's ease';\n                            }\n\n                            item.style.transition = transition;\n                        });\n\n                        requestAnimationFrame(() => this.transform(1));\n\n                        attachTimeout(\n                            this._options.element,\n                            () => {\n                                this.clear();\n                                resolve();\n                            },\n                            this.options.transformTiming,\n                            'transform'\n                        );\n                    });\n                };\n\n                this.clear();\n                this.store(0);\n                this.transform(0);\n\n                const changes = layoutChanges();\n\n                if (isPromise(changes)) {\n                    changes.then(() => callback());\n                } else {\n                    callback();\n                }\n            });\n\n            return animation;\n        }\n\n        filter(filter = '*') {\n            const matched = this._options.items.filter(x => x.matches(filter));\n            const unmatched = this._options.items.filter(x => !x.matches(filter));\n            const hiddenMatched = matched.filter(x => x.style.display === 'none');\n            const makeRoomBeforeFade = matched.length !== hiddenMatched.length;\n            const prepareFade = () => {\n                this._options.items.forEach(item => {\n                    item.style.transition = 'opacity ' + this._options.opacityTimingCSS + 's ease';\n                });\n            };\n            const fade = () => {\n                matched.forEach(item => {\n                    item.style.opacity = 1;\n                });\n\n                unmatched.forEach(item => {\n                    item.style.opacity = 0;\n                });\n            };\n            const clearFade = () => {\n                this._options.items.forEach(item => {\n                    item.style.transition = '';\n                    item.style.opacity = '';\n                });\n\n                matched.forEach(item => {\n                    item.style.display = '';\n                });\n\n                unmatched.forEach(item => {\n                    item.style.display = 'none';\n                });\n            };\n\n            const animation = this.animate(() => {\n                const fadeAfterAnimation = new Promise((resolve, reject) => {\n                    const onFadeEnd = () => {\n                        this.store(0);\n                        this.transform(0);\n                        resolve();\n                    };\n\n                    prepareFade();\n\n                    if (hiddenMatched.length) {\n                        hiddenMatched.forEach(item => {\n                            item.style.opacity = 0;\n                        });\n                    }\n\n                    requestAnimationFrame(() => {\n                        if (hiddenMatched.length) {\n                            hiddenMatched.forEach(item => {\n                                item.style.display = '';\n                            });\n                        }\n\n                        if (hiddenMatched.length && makeRoomBeforeFade) {\n                            requestAnimationFrame(() => onFadeEnd());\n                        } else if (!hiddenMatched.length || (hiddenMatched.length && !makeRoomBeforeFade)) {\n                            requestAnimationFrame(() => {\n                                fade();\n\n                                attachTimeout(\n                                    this._options.element,\n                                    () => {\n                                        clearFade();\n\n                                        requestAnimationFrame(() => onFadeEnd());\n                                    },\n                                    this.options.opacityTiming,\n                                    'opacity'\n                                );\n                            });\n                        }\n                    });\n                });\n\n                return fadeAfterAnimation;\n            });\n\n            animation.then(() => {\n                if (makeRoomBeforeFade) {\n                    prepareFade();\n\n                    requestAnimationFrame(() => {\n                        fade();\n\n                        clearTimeout(this._filterTimeout);\n\n                        this._filterTimeout = setTimeout(() => clearFade(), this.options.opacityTiming);\n                    });\n                }\n            });\n        }\n\n        destroy() {\n            // TODO: do it\n        }\n\n        refresh() {\n            // TODO: do it\n        }\n\n        // TODO: private\n        layout() {\n            if (this._options.masonry) {\n                const rowHeight = parseInt(window.getComputedStyle(this._options.element).getPropertyValue('grid-auto-rows'));\n                const rowGap = parseInt(window.getComputedStyle(this._options.element).getPropertyValue('grid-row-gap'));\n\n                this._options.items.filter(item => item.style.display !== 'none').forEach(item => {\n                    const rowSpan = Math.ceil((item.querySelector('.content').getBoundingClientRect().height + rowGap) / (rowHeight + rowGap));\n                    item.style.gridRowEnd = 'span ' + rowSpan;\n                });\n            }\n        }\n\n        // TODO: private\n        clear() {\n            this._options.element.style.position = '';\n            this._options.element.style.width = '';\n            this._options.element.style.height = '';\n            this._options.element.style.transition = '';\n\n            this._options.items.forEach(item => {\n                item.style.transform = '';\n                item.style.transformOrigin = '';\n                item.style.position = '';\n                item.style.transition = '';\n                item.style.width = '';\n                item.style.height = '';\n                item.style.margin = '';\n            });\n        }\n\n        // TODO: private\n        store(id = 0) {\n            const scroll = {\n                top: document.body.scrollTop,\n                left: document.body.scrollLeft\n            };\n            const gridRect = this._options.element.getBoundingClientRect();\n            if (!('rect' in this._options.element)) {\n                this._options.element.rect = [];\n            }\n            this._options.element.rect[id] = {\n                width: gridRect.width,\n                height: gridRect.height,\n                top: gridRect.top + scroll.top,\n                left: gridRect.left + scroll.left\n            };\n            this._options.items.filter(item => item.style.display !== 'none').forEach(item => {\n                if (!('rect' in item)) {\n                    item.rect = [];\n                }\n                const itemRect = item.getBoundingClientRect();\n                item.rect[id] = {\n                    width: itemRect.width,\n                    height: itemRect.height,\n                    top: itemRect.top + scroll.top - this._options.element.rect[id].top,\n                    left: itemRect.left + scroll.left - this._options.element.rect[id].left,\n                    scaleX: 1,\n                    scaleY: 1\n                };\n                item.rect[id].top = item.rect[id].top >= 0 ? item.rect[id].top : 0;\n                item.rect[id].left = item.rect[id].left >= 0 ? item.rect[id].left : 0;\n                if (id === 1) {\n                    const scaleX = item.rect[0].width / itemRect.width;\n                    const scaleY = item.rect[0].height / itemRect.height;\n                    if (scaleX > 0) {\n                        item.rect[id].scaleX = 1 / scaleX;\n                    }\n                    if (scaleY > 0) {\n                        item.rect[id].scaleY = 1 / scaleY;\n                    }\n                }\n            });\n        }\n\n        // TODO: private\n        transform(id = 0) {\n            this._options.element.style.position = 'relative';\n            this._options.element.style.width = this._options.element.rect[id].width + 'px';\n            this._options.element.style.height = this._options.element.rect[id].height + 'px';\n\n            this._options.items.filter(item => item.style.display !== 'none').forEach(item => {\n                let transform = 'translate3d(' + item.rect[id].left + 'px,' + item.rect[id].top + 'px, 0px)';\n\n                if (!this.options.animateWidthAndHeight) {\n                    transform += ' scale3d(' + item.rect[id].scaleX + ', ' + item.rect[id].scaleY + ', 1)';\n                }\n\n                if (this.options.animateWidthAndHeight || id === 0) {\n                    item.style.width = item.rect[id].width + 'px';\n                    item.style.height = item.rect[id].height + 'px';\n                }\n\n                item.style.margin = 0;\n                item.style.position = 'absolute';\n                item.style.transformOrigin = '0 0 0';\n                item.style.transform = transform;\n            });\n        }\n    }\n\n    return Griddie;\n\n})));\n"]}