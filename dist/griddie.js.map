{"version":3,"sources":["griddie.js"],"names":["global","factory","exports","module","define","amd","Griddie","isPromise","object","then","options","_options","_animationTimeout","_filterTimeout","layout","window","addEventListener","layoutChanges","animation","Promise","resolve","reject","callback","clear","store","transform","requestAnimationFrame","element","style","transition","transformTimingCSS","items","filter","item","display","forEach","animateWidthAndHeight","clearTimeout","setTimeout","transformTiming","changes","matched","x","matches","unmatched","hiddenMatched","makeRoomBeforeFade","length","prepareFade","opacityTimingCSS","fade","opacity","clearFade","animate","fadeAfterAnimation","onFadeEnd","opacityTiming","masonry","rowHeight","parseInt","getComputedStyle","getPropertyValue","rowGap","rowSpan","Math","ceil","querySelector","getBoundingClientRect","height","gridRowEnd","position","width","transformOrigin","margin","id","scroll","top","document","body","scrollTop","left","scrollLeft","gridRect","rect","itemRect","scaleX","scaleY","children"],"mappings":"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","file":"griddie.js","sourcesContent":["(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n    typeof define === 'function' && define.amd ? define('Griddie', factory) :\n    (global.Griddie = factory());\n}(this, (function () { 'use strict';\n\n    const isPromise = object => !!object && (typeof object === 'object' || typeof object === 'function') && typeof object.then === 'function';\n\n    class Griddie {\n        constructor(options) {\n            this._options = {};\n\n            this._animationTimeout = null; // TODO: replace with toolbox.timer ...\n            this._filterTimeout = null; // TODO: replace with toolbox.timer ...\n\n            this.options = options;\n            this.layout();\n            window.addEventListener('resize', () => this.layout());\n        }\n\n        set options(options) {\n            this._options = {\n                ...{\n                    animateWidthAndHeight: true, // TODO: single item exceptions ...\n                    opacityTiming: 300,\n                    transformTiming: 300,\n                    masonry: false\n                },\n                ...options\n            };\n            this._options.transformTimingCSS = this.options.transformTiming / 1000;\n            this._options.opacityTimingCSS = this.options.opacityTiming / 1000;\n            this._options.items = [...this._options.element.children];\n        }\n\n        get options() {\n            return this._options;\n        }\n\n        animate(layoutChanges = () => {}) {\n            const animation = new Promise((resolve, reject) => {\n                const callback = () => {\n                    this.clear();\n                    this.layout(0);\n                    this.store(1);\n                    this.transform(0);\n\n                    requestAnimationFrame(() => {\n                        this._options.element.style.transition = 'height ' + this._options.transformTimingCSS + 's ease';\n                        [...this._options.items].filter(item => item.style.display !== 'none').forEach(item => {\n                            let transition = 'transform ' + this._options.transformTimingCSS + 's ease';\n                            if (this.options.animateWidthAndHeight) {\n                                transition += ', width ' + this._options.transformTimingCSS + 's ease, height ' + this._options.transformTimingCSS + 's ease';\n                            }\n\n                            item.style.transition = transition;\n                        });\n\n                        requestAnimationFrame(() => this.transform(1));\n\n                        clearTimeout(this._animationTimeout);\n                        this._animationTimeout = setTimeout(() => {\n                            this.clear();\n                            resolve();\n                        }, this.options.transformTiming);\n                    });\n                };\n\n                this.clear();\n                this.store(0);\n                this.transform(0);\n\n                const changes = layoutChanges();\n\n                if (isPromise(changes)) {\n                    changes.then(() => callback());\n                } else {\n                    callback();\n                }\n            });\n\n            return animation;\n        }\n\n        filter(filter = '*') {\n            const matched = this._options.items.filter(x => x.matches(filter));\n            const unmatched = this._options.items.filter(x => !x.matches(filter));\n            const hiddenMatched = matched.filter(x => x.style.display === 'none');\n            const makeRoomBeforeFade = matched.length !== hiddenMatched.length;\n            const prepareFade = () => {\n                this._options.items.forEach(item => {\n                    item.style.transition = 'opacity ' + this._options.opacityTimingCSS + 's ease';\n                });\n            };\n            const fade = () => {\n                matched.forEach(item => {\n                    item.style.opacity = 1;\n                });\n\n                unmatched.forEach(item => {\n                    item.style.opacity = 0;\n                });\n            };\n            const clearFade = () => {\n                this._options.items.forEach(item => {\n                    item.style.transition = '';\n                    item.style.opacity = '';\n                });\n\n                matched.forEach(item => {\n                    item.style.display = '';\n                });\n\n                unmatched.forEach(item => {\n                    item.style.display = 'none';\n                });\n            };\n\n            const animation = this.animate(() => {\n                const fadeAfterAnimation = new Promise((resolve, reject) => {\n                    const onFadeEnd = () => {\n                        this.store(0);\n                        this.transform(0);\n                        resolve();\n                    };\n\n                    prepareFade();\n\n                    if (hiddenMatched.length) {\n                        hiddenMatched.forEach(item => {\n                            item.style.opacity = 0;\n                        });\n                    }\n\n                    requestAnimationFrame(() => {\n                        if (hiddenMatched.length) {\n                            hiddenMatched.forEach(item => {\n                                item.style.display = '';\n                            });\n                        }\n\n                        if (hiddenMatched.length && makeRoomBeforeFade) {\n                            requestAnimationFrame(() => onFadeEnd());\n                        } else if (!hiddenMatched.length || (hiddenMatched.length && !makeRoomBeforeFade)) {\n                            requestAnimationFrame(() => {\n                                fade();\n\n                                clearTimeout(this._filterTimeout);\n\n                                this._filterTimeout = setTimeout(() => {\n                                    clearFade();\n\n                                    requestAnimationFrame(() => onFadeEnd());\n                                }, this.options.opacityTiming);\n                            });\n                        }\n                    });\n                });\n\n                return fadeAfterAnimation;\n            });\n\n            animation.then(() => {\n                if (makeRoomBeforeFade) {\n                    prepareFade();\n\n                    requestAnimationFrame(() => {\n                        fade();\n\n                        clearTimeout(this._filterTimeout);\n\n                        this._filterTimeout = setTimeout(() => clearFade(), this.options.opacityTiming);\n                    });\n                }\n            });\n        }\n\n        destroy() {\n            // TODO: do it\n        }\n\n        refresh() {\n            // TODO: do it\n        }\n\n        // TODO: private\n        layout() {\n            if (this._options.masonry) {\n                const rowHeight = parseInt(window.getComputedStyle(this._options.element).getPropertyValue('grid-auto-rows'));\n                const rowGap = parseInt(window.getComputedStyle(this._options.element).getPropertyValue('grid-row-gap'));\n\n                this._options.items.filter(item => item.style.display !== 'none').forEach(item => {\n                    const rowSpan = Math.ceil((item.querySelector('.content').getBoundingClientRect().height + rowGap) / (rowHeight + rowGap));\n                    item.style.gridRowEnd = 'span ' + rowSpan;\n                });\n            }\n        }\n\n        // TODO: private\n        clear() {\n            this._options.element.style.position = '';\n            this._options.element.style.width = '';\n            this._options.element.style.height = '';\n            this._options.element.style.transition = '';\n\n            this._options.items.forEach(item => {\n                item.style.transform = '';\n                item.style.transformOrigin = '';\n                item.style.position = '';\n                item.style.transition = '';\n                item.style.width = '';\n                item.style.height = '';\n                item.style.margin = '';\n            });\n        }\n\n        // TODO: private\n        store(id = 0) {\n            const scroll = {\n                top: document.body.scrollTop,\n                left: document.body.scrollLeft\n            };\n            const gridRect = this._options.element.getBoundingClientRect();\n            if (!('rect' in this._options.element)) {\n                this._options.element.rect = [];\n            }\n            this._options.element.rect[id] = {\n                width: gridRect.width,\n                height: gridRect.height,\n                top: gridRect.top + scroll.top,\n                left: gridRect.left + scroll.left\n            };\n            this._options.items.filter(item => item.style.display !== 'none').forEach(item => {\n                if (!('rect' in item)) {\n                    item.rect = [];\n                }\n                const itemRect = item.getBoundingClientRect();\n                item.rect[id] = {\n                    width: itemRect.width,\n                    height: itemRect.height,\n                    top: itemRect.top + scroll.top - this._options.element.rect[id].top,\n                    left: itemRect.left + scroll.left - this._options.element.rect[id].left,\n                    scaleX: 1,\n                    scaleY: 1\n                };\n                item.rect[id].top = item.rect[id].top >= 0 ? item.rect[id].top : 0;\n                item.rect[id].left = item.rect[id].left >= 0 ? item.rect[id].left : 0;\n                if (id === 1) {\n                    const scaleX = item.rect[0].width / itemRect.width;\n                    const scaleY = item.rect[0].height / itemRect.height;\n                    if (scaleX > 0) {\n                        item.rect[id].scaleX = 1 / scaleX;\n                    }\n                    if (scaleY > 0) {\n                        item.rect[id].scaleY = 1 / scaleY;\n                    }\n                }\n            });\n        }\n\n        // TODO: private\n        transform(id = 0) {\n            this._options.element.style.position = 'relative';\n            this._options.element.style.width = this._options.element.rect[id].width + 'px';\n            this._options.element.style.height = this._options.element.rect[id].height + 'px';\n\n            this._options.items.filter(item => item.style.display !== 'none').forEach(item => {\n                let transform = 'translate3d(' + item.rect[id].left + 'px,' + item.rect[id].top + 'px, 0px)';\n\n                if (!this.options.animateWidthAndHeight) {\n                    transform += ' scale3d(' + item.rect[id].scaleX + ', ' + item.rect[id].scaleY + ', 1)';\n                }\n\n                if (this.options.animateWidthAndHeight || id === 0) {\n                    item.style.width = item.rect[id].width + 'px';\n                    item.style.height = item.rect[id].height + 'px';\n                }\n\n                item.style.margin = 0;\n                item.style.position = 'absolute';\n                item.style.transformOrigin = '0 0 0';\n                item.style.transform = transform;\n            });\n        }\n    }\n\n    return Griddie;\n\n})));\n"]}