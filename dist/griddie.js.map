{"version":3,"sources":["griddie.js"],"names":["global","factory","exports","module","define","amd","Griddie","isPromise","object","then","userAgent","navigator","toLowerCase","vendorsPrefixes","MutationObserver","i","length","window","transitionEndEventName","el","document","createElement","transEndEventNames","WebkitTransition","MozTransition","OTransition","msTransition","transition","name","style","undefined","getObserverId","parent","prefix","classList","join","id","disconnectObserver","mode","observerId","disconnect","setElementTimer","element","callback","time","clearElementTimer","parentElement","e","removedNodes","some","observe","childList","autoDisconnectObserver","attachTimeout","detachTimeout","stringContains","heystack","needle","String","prototype","includes","indexOf","stringStartsWith","startsWith","substr","Viewport","_window","_html","documentElement","_body","body","_frame1","_frame2","_prefix1","_prefix2","_offsetWidth","_offsetHeight","_width","_height","_scrollTop","_scrollLeft","_lock","calcAll","offsetWidth","offsetHeight","width","height","scrollTop","scrollLeft","calcOffsetWidth","calcOffsetHeight","calcWidth","calcHeight","calcScrollTop","calcScrollLeft","all","bool","top","left","scrollBarWidth","scrollBarHeight","position","Math","abs","parseFloat","scroll","behavior","eventNamespaceParserSeparator","privateEventsStorage","CustomEvent","_polyfill","event","params","bubbles","cancelable","detail","evt","createEvent","initCustomEvent","Event","detachEventListener","events","key","eventNameWithNamespace","replace","split","type","namespace","removeEventListener","handler","attachEventListener","once","count","_handler","call","addEventListener","options","_element","_items","children","_options","_viewport","instance","layout","layoutChanges","animation","Promise","resolve","reject","clear","store","transform","requestAnimationFrame","transformTimingCSS","filter","item","display","forEach","scaleXY","transformTiming","changes","matched","x","matches","unmatched","hiddenMatched","makeRoomBeforeFade","prepareFade","opacityTimingCSS","fade","opacity","clearFade","animate","fadeAfterAnimation","onFadeEnd","opacityTiming","clearTimeout","_filterTimeout","setTimeout","gridRowEnd","rect","masonry","getComputedStyle","getPropertyValue","gridTemplateColumns","rowHeight","gridAutoRows","parseInt","gridColumnGap","rowGap","gridRowGap","rowSpan","ceil","getBoundingClientRect","transformOrigin","margin","gridRect","itemRect","scaleX","scaleY"],"mappings":"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","file":"griddie.js","sourcesContent":["(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n    typeof define === 'function' && define.amd ? define('Griddie', factory) :\n    (global.Griddie = factory());\n}(this, (function () { 'use strict';\n\n    const isPromise = object => !!object && (typeof object === 'object' || typeof object === 'function') && typeof object.then === 'function';\n\n    const userAgent = navigator.userAgent.toLowerCase();\n\n    const vendorsPrefixes = ['WebKit', 'Moz', 'O', 'Ms', ''];\n\n    const MutationObserver = (() => {\n        for (let i = 0; i < vendorsPrefixes.length; i++) {\n            if (vendorsPrefixes[i] + 'MutationObserver' in window) {\n                return window[vendorsPrefixes[i] + 'MutationObserver'];\n            }\n        }\n\n        return false;\n    })();\n\n    const transitionEndEventName = (() => {\n        const el = document.createElement('div');\n\n        const transEndEventNames = {\n            WebkitTransition: 'webkitTransitionEnd',\n            MozTransition: 'transitionend',\n            OTransition: 'oTransitionEnd otransitionend',\n            msTransition: 'MSTransitionEnd',\n            transition: 'transitionend'\n        };\n\n        for (let name in transEndEventNames) {\n            if (el.style[name] !== undefined) {\n                return transEndEventNames[name];\n            }\n        }\n\n        return false;\n    })();\n\n    const getObserverId = (parent, prefix) => prefix + [...parent.classList].join('') + parent.id + 'Observer';\n\n    const disconnectObserver = (parent, mode, id) => {\n        const observerId = getObserverId(parent, id + mode);\n        if (parent[observerId]) {\n            parent[observerId].disconnect();\n            delete parent[observerId];\n        }\n    };\n\n    const setElementTimer = (element, mode, callback, time, id) => {\n        clearElementTimer(element, mode, id);\n        element[id] = window['set' + mode](callback, time);\n\n        const parent = element.parentElement;\n        const observerId = getObserverId(parent, id + mode);\n        parent[observerId] = new MutationObserver(e => {\n            if ([...e[0].removedNodes].some(el => el === element)) {\n                clearElementTimer(element, mode, id);\n                disconnectObserver(parent, mode, id);\n            }\n        });\n        parent[observerId].observe(parent, { childList: true });\n    };\n\n    const clearElementTimer = (element, mode, id, autoDisconnectObserver = false) => {\n        window['clear' + mode](element[id]);\n        delete element[id];\n\n        const parent = element.parentElement;\n        if (autoDisconnectObserver) {\n            disconnectObserver(parent, mode, id);\n        }\n    };\n\n    const attachTimeout = (element, callback = () => {}, time = 0, id = 'niteTimeout') => setElementTimer(element, 'Timeout', callback, time, id);\n    const detachTimeout = (element, id = 'niteTimeout') => clearElementTimer(element, 'Timeout', id, true);\n\n    /**\n     * @param {string} prop\n     * @param {string} value\n     * @returns {boolean}\n     */\n\n    /**\n     * @param {string} heystack\n     * @param {string} needle\n     * @returns {boolean}\n     */\n    const stringContains = (heystack, needle) => {\n        return String.prototype.includes ? heystack.includes(needle) : heystack.indexOf(needle, 0) !== -1;\n    };\n\n    /**\n     * @param {string} heystack\n     * @param {string} needle\n     * @returns {boolean}\n     */\n    const stringStartsWith = (heystack, needle) => {\n        return String.prototype.startsWith ? heystack.startsWith(needle) : heystack.substr(0, needle.length) === needle;\n    };\n\n    /**\n     *\n     */\n    class Viewport {\n        constructor() {\n            this._window = window;\n            this._html = document.documentElement;\n            this._body = document.body;\n\n            this._frame1 = this._window;\n            this._frame2 = this._html || this._body;\n            this._prefix1 = 'inner';\n            this._prefix2 = 'offset';\n            if (!this._prefix1 + 'Width' in this._frame1) {\n                this._prefix1 = 'client';\n                this._frame1 = this._frame2;\n            }\n\n            this._offsetWidth = 0;\n            this._offsetHeight = 0;\n            this._width = 0;\n            this._height = 0;\n            this._scrollTop = 0;\n            this._scrollLeft = 0;\n\n            this._lock = false;\n\n            this.calcAll();\n        }\n\n        get offsetWidth() {\n            return this._offsetWidth;\n        }\n        get offsetHeight() {\n            return this._offsetHeight;\n        }\n        get width() {\n            return this._width;\n        }\n        get height() {\n            return this._height;\n        }\n        get scrollTop() {\n            return this._scrollTop;\n        }\n        get scrollLeft() {\n            return this._scrollLeft;\n        }\n        get all() {\n            return {\n                offsetWidth: this.offsetWidth,\n                offsetHeight: this.offsetHeight,\n                width: this.width,\n                height: this.height,\n                scrollTop: this.scrollTop,\n                scrollLeft: this.scrollLeft\n            };\n        }\n\n        calcOffsetWidth() {\n            this._offsetWidth = this._body[this._prefix2 + 'Width'];\n            return this.offsetWidth;\n        }\n        calcOffsetHeight() {\n            this._offsetHeight = this._body[this._prefix2 + 'Height'];\n            return this.offsetHeight;\n        }\n        calcWidth() {\n            this._width = this._frame1[this._prefix1 + 'Width'];\n            return this.width;\n        }\n        calcHeight() {\n            this._height = this._frame1[this._prefix1 + 'Height'];\n            return this.height;\n        }\n        calcScrollTop() {\n            this._scrollTop = this._frame2.scrollTop || 0;\n            return this.scrollTop;\n        }\n        calcScrollLeft() {\n            this._scrollLeft = this._frame2.scrollLeft || 0;\n            return this.scrollLeft;\n        }\n        calcAll() {\n            this.calcOffsetWidth();\n            this.calcOffsetHeight();\n            this.calcWidth();\n            this.calcHeight();\n            this.calcScrollTop();\n            this.calcScrollLeft();\n            return this.all;\n        }\n\n        get lock() {\n            return this._lock;\n        }\n\n        set lock(bool) {\n            this._lock = bool;\n\n            if (this._lock) {\n                this._body.style.top = -this.calcScrollTop() + 'px';\n                this._body.style.left = -this.calcScrollLeft() + 'px';\n\n                let scrollBarWidth = this.calcOffsetWidth();\n                let scrollBarHeight = this.calcOffsetHeight();\n\n                this._html.style.top = '0px';\n                this._html.style.left = '0px';\n                this._html.style.position = 'fixed';\n                this._body.style.position = 'fixed';\n                this._html.style.width = '100%';\n                this._body.style.width = '100%';\n\n                let offsetWidth = this.calcOffsetWidth();\n                let offsetHeight = this.calcOffsetHeight();\n                scrollBarWidth = offsetWidth - scrollBarWidth;\n                scrollBarHeight = offsetHeight - scrollBarHeight;\n\n                this._body.style.width = offsetWidth - scrollBarWidth + 'px';\n                this._body.style.height = offsetHeight - scrollBarHeight + 'px';\n            } else {\n                let scrollTop = Math.abs(parseFloat(this._body.style.top));\n                let scrollLeft = Math.abs(parseFloat(this._body.style.left));\n\n                this._html.style.position = '';\n                this._html.style.top = '';\n                this._html.style.left = '';\n                this._html.style.width = '';\n                this._body.style.position = '';\n                this._body.style.top = '';\n                this._body.style.left = '';\n                this._body.style.width = '';\n\n                this._window.scroll({\n                    top: scrollTop,\n                    left: scrollLeft,\n                    behavior: 'instant'\n                });\n            }\n        }\n    }\n\n    const eventNamespaceParserSeparator = '__namespace__';\n    let privateEventsStorage = {};\n\n    const CustomEvent =\n        window.CustomEvent ||\n        (() => {\n            const _polyfill = (event, params) => {\n                params = params || { bubbles: false, cancelable: false, detail: undefined };\n                const evt = document.createEvent('CustomEvent');\n                evt.initCustomEvent(event, params.bubbles, params.cancelable, params.detail);\n                return evt;\n            };\n            _polyfill.prototype = window.Event.prototype;\n            return _polyfill;\n        })();\n\n    /**\n     * @param {HTMLElement} element\n     * @param {string} events\n     * @returns {undefined}\n     */\n    const detachEventListener = (element, events) => {\n        if (!element || typeof events !== 'string') {\n            return;\n        }\n\n        if (stringStartsWith(events, '.')) {\n            for (let key in privateEventsStorage) {\n                const eventNameWithNamespace = key.replace(eventNamespaceParserSeparator, '.');\n                if (stringContains(eventNameWithNamespace, events) && privateEventsStorage[key].element === element) {\n                    detachEventListener(element, eventNameWithNamespace);\n                }\n            }\n        } else {\n            events = events.split('.');\n\n            const type = events[0],\n                namespace = events[1];\n\n            if (namespace) {\n                events = events.join(eventNamespaceParserSeparator);\n            }\n\n            if (events in privateEventsStorage) {\n                element.removeEventListener(type, privateEventsStorage[events].handler);\n                delete privateEventsStorage[events];\n            }\n        }\n    };\n\n    /**\n     * @param {HTMLElement} element\n     * @param {string} events\n     * @param {Function} handler\n     * @param {boolean} once\n     * @returns {undefined}\n     */\n    // TODO: Class EventListener .on .one .off .trigger jQuery-like...\n    const attachEventListener = (element, events, handler, once) => {\n        if (!element || typeof events !== 'string' || typeof handler !== 'function') {\n            return;\n        }\n\n        events = events.split('.');\n\n        const type = events[0];\n        const namespace = events[1];\n\n        if (namespace) {\n            events = events.join(eventNamespaceParserSeparator);\n        }\n\n        privateEventsStorage[events] = { element: element, count: 0, once: false };\n\n        if (true === once) {\n            let _handler = handler;\n            handler = function(event) {\n                if (events in privateEventsStorage) {\n                    privateEventsStorage[events].count++;\n                    if (privateEventsStorage[events].once && privateEventsStorage[events].count > 1) {\n                        return;\n                    }\n                    _handler.call(this, event);\n                }\n                detachEventListener(element, events);\n            };\n        } else {\n            once = false;\n        }\n\n        privateEventsStorage[events] = {\n            ...privateEventsStorage[events],\n            ...{ handler: handler, once: once }\n        };\n\n        element.addEventListener(type, privateEventsStorage[events].handler, { once: once });\n    };\n\n    class Griddie {\n        constructor(element, options) {\n            this._element = element;\n            this._items = [...this._element.children];\n            this._options = {};\n            this._viewport = new Viewport();\n\n            this._element.instance = this;\n\n            this.options = options;\n            this.layout();\n            attachEventListener(window, 'resize.griddie', () => this.layout());\n        }\n\n        set options(options) {\n            this._options = {\n                ...{\n                    scaleXY: false, // TODO: single item exceptions ...\n                    opacityTiming: 300,\n                    transformTiming: 300,\n                    masonry: false\n                },\n                ...options\n            };\n            this._options.transformTimingCSS = this.options.transformTiming / 1000;\n            this._options.opacityTimingCSS = this.options.opacityTiming / 1000;\n        }\n\n        get options() {\n            return this._options;\n        }\n\n        animate(layoutChanges = () => {}) {\n            if (!('instance' in this._element)) {\n                return;\n            }\n\n            const animation = new Promise((resolve, reject) => {\n                const callback = () => {\n                    this.clear();\n                    this.layout(0);\n                    this.store(1);\n                    this.transform(0);\n\n                    requestAnimationFrame(() => {\n                        this._element.style.transition = 'height ' + this._options.transformTimingCSS + 's ease';\n\n                        [...this._items].filter(item => item.style.display !== 'none').forEach(item => {\n                            let transition = 'transform ' + this._options.transformTimingCSS + 's ease';\n                            if (!this.options.scaleXY) {\n                                transition += ', width ' + this._options.transformTimingCSS + 's ease, height ' + this._options.transformTimingCSS + 's ease';\n                            }\n\n                            item.style.transition = transition;\n                        });\n\n                        requestAnimationFrame(() => this.transform(1));\n\n                        attachTimeout(\n                            this._element,\n                            () => {\n                                this.clear();\n                                resolve();\n                            },\n                            this.options.transformTiming,\n                            'transform'\n                        );\n                    });\n                };\n\n                detachTimeout(this._element, 'transform');\n\n                this.clear();\n                this.store(0);\n                this.transform(0);\n\n                const changes = layoutChanges();\n\n                if (isPromise(changes)) {\n                    changes.then(() => callback());\n                } else {\n                    callback();\n                }\n            });\n\n            return animation;\n        }\n\n        filter(filter = '*') {\n            if (!('instance' in this._element)) {\n                return;\n            }\n\n            const matched = this._items.filter(x => x.matches(filter));\n            const unmatched = this._items.filter(x => !x.matches(filter));\n            const hiddenMatched = matched.filter(x => x.style.display === 'none');\n            const makeRoomBeforeFade = matched.length !== hiddenMatched.length;\n\n            const prepareFade = () => {\n                this._items.forEach(item => {\n                    item.style.transition = 'opacity ' + this._options.opacityTimingCSS + 's ease';\n                });\n            };\n            const fade = () => {\n                matched.forEach(item => {\n                    item.style.opacity = 1;\n                });\n\n                unmatched.forEach(item => {\n                    item.style.opacity = 0;\n                });\n            };\n            const clearFade = () => {\n                this._items.forEach(item => {\n                    item.style.transition = '';\n                    item.style.opacity = '';\n                });\n\n                matched.forEach(item => {\n                    item.style.display = '';\n                });\n\n                unmatched.forEach(item => {\n                    item.style.display = 'none';\n                });\n            };\n\n            const animation = this.animate(() => {\n                detachTimeout(this._element, 'opacity');\n\n                const fadeAfterAnimation = new Promise((resolve, reject) => {\n                    const onFadeEnd = () => {\n                        this.store(0);\n                        this.transform(0);\n                        resolve();\n                    };\n\n                    prepareFade();\n\n                    if (hiddenMatched.length) {\n                        hiddenMatched.forEach(item => {\n                            item.style.opacity = 0;\n                        });\n                    }\n\n                    requestAnimationFrame(() => {\n                        if (hiddenMatched.length) {\n                            hiddenMatched.forEach(item => {\n                                item.style.display = '';\n                            });\n                        }\n\n                        if (hiddenMatched.length && makeRoomBeforeFade) {\n                            requestAnimationFrame(() => onFadeEnd());\n                        } else if (!hiddenMatched.length || (hiddenMatched.length && !makeRoomBeforeFade)) {\n                            requestAnimationFrame(() => {\n                                fade();\n\n                                attachTimeout(\n                                    this._element,\n                                    () => {\n                                        clearFade();\n\n                                        requestAnimationFrame(() => onFadeEnd());\n                                    },\n                                    this.options.opacityTiming,\n                                    'opacity'\n                                );\n                            });\n                        }\n                    });\n                });\n\n                return fadeAfterAnimation;\n            });\n\n            animation.then(() => {\n                if (makeRoomBeforeFade) {\n                    prepareFade();\n\n                    requestAnimationFrame(() => {\n                        fade();\n\n                        clearTimeout(this._filterTimeout);\n\n                        this._filterTimeout = setTimeout(() => clearFade(), this.options.opacityTiming);\n                    });\n                }\n            });\n        }\n\n        destroy() {\n            this.clear();\n            this._items.forEach(item => {\n                item.style.gridRowEnd = ''; // TODO: possibly in clear()?\n                item.style.display = ''; // TODO: possibly in clear()?\n                delete item.rect;\n            });\n            delete this._element.rect;\n            detachTimeout(this._element, 'transform');\n            detachTimeout(this._element, 'opacity');\n            detachEventListener(window, 'resize.griddie');\n            delete this._element.instance;\n        }\n\n        refresh() {\n            if (!('instance' in this._element)) {\n                return;\n            }\n            // TODO: do it\n        }\n\n        // TODO: private\n        layout() {\n            if (!('instance' in this._element)) {\n                return;\n            }\n\n            if (this._options.masonry) {\n                if (window.getComputedStyle(this._element).getPropertyValue('grid-template-columns') === 'none') {\n                    this._element.style.gridTemplateColumns = 'repeat(auto-fill, minmax(250px, 1fr))';\n                }\n\n                if (window.getComputedStyle(this._element).getPropertyValue('display') !== 'grid') {\n                    this._element.style.display = 'grid';\n                }\n\n                let rowHeight = window.getComputedStyle(this._element).getPropertyValue('grid-auto-rows');\n                if (rowHeight === 'auto') {\n                    rowHeight = this._element.style.gridAutoRows = '20px';\n                }\n                rowHeight = parseInt(rowHeight);\n\n                if (window.getComputedStyle(this._element).getPropertyValue('grid-column-gap') === 'normal') {\n                    this._element.style.gridColumnGap = '0px';\n                }\n\n                let rowGap = window.getComputedStyle(this._element).getPropertyValue('grid-row-gap');\n                if (rowGap === 'normal') {\n                    rowGap = this._element.style.gridRowGap = '0px';\n                }\n                rowGap = parseInt(rowGap);\n\n                this._items.filter(item => item.style.display !== 'none').forEach(item => {\n                    const rowSpan = Math.ceil(([...item.children][0].getBoundingClientRect().height + rowGap) / (rowHeight + rowGap));\n                    item.style.gridRowEnd = 'span ' + rowSpan;\n                });\n            } else {\n                this._element.style.gridTemplateColumns = '';\n                this._element.style.display = '';\n                this._element.style.gridAutoRows = '';\n                this._element.style.gridColumnGap = '';\n                this._element.style.gridRowGap = '';\n                this._items.filter(item => item.style.display !== 'none').forEach(item => {\n                    item.style.gridRowEnd = '';\n                });\n            }\n        }\n\n        // TODO: private\n        clear() {\n            if (!('instance' in this._element)) {\n                return;\n            }\n\n            this._element.style.position = '';\n            this._element.style.width = '';\n            this._element.style.height = '';\n            this._element.style.transition = '';\n\n            this._items.forEach(item => {\n                item.style.transform = '';\n                item.style.transformOrigin = '';\n                item.style.position = '';\n                item.style.transition = '';\n                item.style.width = '';\n                item.style.height = '';\n                item.style.margin = '';\n            });\n        }\n\n        // TODO: private\n        store(id = 0) {\n            if (!('instance' in this._element)) {\n                return;\n            }\n\n            this._viewport.calcScrollTop();\n            this._viewport.calcScrollLeft();\n\n            const gridRect = this._element.getBoundingClientRect();\n            if (!('rect' in this._element)) {\n                this._element.rect = [];\n            }\n\n            this._element.rect[id] = {\n                width: gridRect.width,\n                height: gridRect.height,\n                top: gridRect.top + this._viewport.scrollTop,\n                left: gridRect.left + this._viewport.scrollLeft\n            };\n\n            this._items.filter(item => item.style.display !== 'none').forEach(item => {\n                if (!('rect' in item)) {\n                    item.rect = [];\n                }\n\n                const itemRect = item.getBoundingClientRect();\n                item.rect[id] = {\n                    width: itemRect.width,\n                    height: itemRect.height,\n                    top: itemRect.top + this._viewport.scrollTop - this._element.rect[id].top,\n                    left: itemRect.left + this._viewport.scrollLeft - this._element.rect[id].left,\n                    scaleX: 1,\n                    scaleY: 1\n                };\n\n                item.rect[id].top = item.rect[id].top >= 0 ? item.rect[id].top : 0;\n                item.rect[id].left = item.rect[id].left >= 0 ? item.rect[id].left : 0;\n\n                if (id === 1) {\n                    const scaleX = item.rect[0].width / itemRect.width;\n                    const scaleY = item.rect[0].height / itemRect.height;\n\n                    if (scaleX > 0) {\n                        item.rect[id].scaleX = 1 / scaleX;\n                    }\n\n                    if (scaleY > 0) {\n                        item.rect[id].scaleY = 1 / scaleY;\n                    }\n                }\n            });\n        }\n\n        // TODO: private\n        transform(id = 0) {\n            if (!('instance' in this._element)) {\n                return;\n            }\n\n            this._element.style.position = 'relative';\n            this._element.style.width = this._element.rect[id].width + 'px';\n            this._element.style.height = this._element.rect[id].height + 'px';\n\n            this._items.filter(item => item.style.display !== 'none').forEach(item => {\n                let transform = 'translate3d(' + item.rect[id].left + 'px,' + item.rect[id].top + 'px, 0px)';\n\n                if (this.options.scaleXY) {\n                    transform += ' scale3d(' + item.rect[id].scaleX + ', ' + item.rect[id].scaleY + ', 1)';\n                }\n\n                if (!this.options.scaleXY || id === 0) {\n                    item.style.width = item.rect[id].width + 'px';\n                    item.style.height = item.rect[id].height + 'px';\n                }\n\n                item.style.margin = 0;\n                item.style.position = 'absolute';\n                item.style.transformOrigin = '0 0 0';\n                item.style.transform = transform;\n            });\n        }\n    }\n\n    return Griddie;\n\n})));\n"]}