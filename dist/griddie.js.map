{"version":3,"sources":["griddie.js"],"names":["global","factory","exports","module","define","amd","Griddie","isPromise","object","then","options","_options","_animationTimeout","_filterTimeout","layout","window","addEventListener","layoutChanges","animation","Promise","resolve","reject","callback","clear","store","transform","requestAnimationFrame","element","style","transition","transformTimingCSS","items","filter","item","display","forEach","animateWidthAndHeight","clearTimeout","setTimeout","transformTiming","changes","matched","x","matches","unmatched","hiddenMatched","makeRoomBeforeFade","length","prepareFade","opacityTimingCSS","fade","opacity","clearFade","animate","fadeAfterAnimation","onFadeEnd","opacityTiming","masonry","rowHeight","parseInt","getComputedStyle","getPropertyValue","rowGap","rowSpan","Math","ceil","querySelector","getBoundingClientRect","height","gridRowEnd","position","width","transformOrigin","margin","id","scroll","top","document","body","scrollTop","left","scrollLeft","gridRect","rect","itemRect","scaleX","scaleY","children"],"mappings":"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","file":"griddie.js","sourcesContent":["(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n    typeof define === 'function' && define.amd ? define('Griddie', factory) :\n    (global.Griddie = factory());\n}(this, (function () { 'use strict';\n\n    const isPromise = object => !!object && (typeof object === 'object' || typeof object === 'function') && typeof object.then === 'function';\n\n    class Griddie {\r\n        constructor(options) {\r\n            this._options = {};\r\n\r\n            this._animationTimeout = null; // TODO: replace with toolbox.timer ...\r\n            this._filterTimeout = null; // TODO: replace with toolbox.timer ...\r\n\r\n            this.options = options;\r\n            this.layout();\r\n            window.addEventListener('resize', this.layout);\r\n        }\r\n\r\n        set options(options) {\r\n            this._options = {\r\n                ...{\r\n                    animateWidthAndHeight: true, // TODO: single item exceptions ...\r\n                    opacityTiming: 300,\r\n                    transformTiming: 300,\r\n                    masonry: false\r\n                },\r\n                ...options\r\n            };\r\n            this._options.transformTimingCSS = this.options.transformTiming / 1000;\r\n            this._options.opacityTimingCSS = this.options.opacityTiming / 1000;\r\n            this._options.items = [...this._options.element.children];\r\n        }\r\n\r\n        get options() {\r\n            return this._options;\r\n        }\r\n\r\n        animate(layoutChanges = () => {}) {\r\n            const animation = new Promise((resolve, reject) => {\r\n                const callback = () => {\r\n                    this.clear();\r\n                    this.layout(0);\r\n                    this.store(1);\r\n                    this.transform(0);\r\n\r\n                    requestAnimationFrame(() => {\r\n                        this._options.element.style.transition = 'height ' + this._options.transformTimingCSS + 's ease';\r\n                        [...this._options.items].filter(item => item.style.display !== 'none').forEach(item => {\r\n                            let transition = 'transform ' + this._options.transformTimingCSS + 's ease';\r\n                            if (this.options.animateWidthAndHeight) {\r\n                                transition += ', width ' + this._options.transformTimingCSS + 's ease, height ' + this._options.transformTimingCSS + 's ease';\r\n                            }\r\n\r\n                            item.style.transition = transition;\r\n                        });\r\n\r\n                        requestAnimationFrame(() => this.transform(1));\r\n\r\n                        clearTimeout(this._animationTimeout);\r\n                        this._animationTimeout = setTimeout(() => {\r\n                            this.clear();\r\n                            resolve();\r\n                        }, this.options.transformTiming);\r\n                    });\r\n                };\r\n\r\n                this.clear();\r\n                this.store(0);\r\n                this.transform(0);\r\n\r\n                const changes = layoutChanges();\r\n\r\n                if (isPromise(changes)) {\r\n                    changes.then(() => callback());\r\n                } else {\r\n                    callback();\r\n                }\r\n            });\r\n\r\n            return animation;\r\n        }\r\n\r\n        filter(filter = '*') {\r\n            const matched = this._options.items.filter(x => x.matches(filter));\r\n            const unmatched = this._options.items.filter(x => !x.matches(filter));\r\n            const hiddenMatched = matched.filter(x => x.style.display === 'none');\r\n            const makeRoomBeforeFade = matched.length !== hiddenMatched.length;\r\n            const prepareFade = () => {\r\n                this._options.items.forEach(item => {\r\n                    item.style.transition = 'opacity ' + this._options.opacityTimingCSS + 's ease';\r\n                });\r\n            };\r\n            const fade = () => {\r\n                matched.forEach(item => {\r\n                    item.style.opacity = 1;\r\n                });\r\n\r\n                unmatched.forEach(item => {\r\n                    item.style.opacity = 0;\r\n                });\r\n            };\r\n            const clearFade = () => {\r\n                this._options.items.forEach(item => {\r\n                    item.style.transition = '';\r\n                    item.style.opacity = '';\r\n                });\r\n\r\n                matched.forEach(item => {\r\n                    item.style.display = '';\r\n                });\r\n\r\n                unmatched.forEach(item => {\r\n                    item.style.display = 'none';\r\n                });\r\n            };\r\n\r\n            const animation = this.animate(() => {\r\n                const fadeAfterAnimation = new Promise((resolve, reject) => {\r\n                    const onFadeEnd = () => {\r\n                        this.store(0);\r\n                        this.transform(0);\r\n                        resolve();\r\n                    };\r\n\r\n                    prepareFade();\r\n\r\n                    if (hiddenMatched.length) {\r\n                        hiddenMatched.forEach(item => {\r\n                            item.style.opacity = 0;\r\n                        });\r\n                    }\r\n\r\n                    requestAnimationFrame(() => {\r\n                        if (hiddenMatched.length) {\r\n                            hiddenMatched.forEach(item => {\r\n                                item.style.display = '';\r\n                            });\r\n                        }\r\n\r\n                        if (hiddenMatched.length && makeRoomBeforeFade) {\r\n                            requestAnimationFrame(() => onFadeEnd());\r\n                        } else if (!hiddenMatched.length || (hiddenMatched.length && !makeRoomBeforeFade)) {\r\n                            requestAnimationFrame(() => {\r\n                                fade();\r\n\r\n                                clearTimeout(this._filterTimeout);\r\n\r\n                                this._filterTimeout = setTimeout(() => {\r\n                                    clearFade();\r\n\r\n                                    requestAnimationFrame(() => onFadeEnd());\r\n                                }, this.options.opacityTiming);\r\n                            });\r\n                        }\r\n                    });\r\n                });\r\n\r\n                return fadeAfterAnimation;\r\n            });\r\n\r\n            animation.then(() => {\r\n                if (makeRoomBeforeFade) {\r\n                    prepareFade();\r\n\r\n                    requestAnimationFrame(() => {\r\n                        fade();\r\n\r\n                        clearTimeout(this._filterTimeout);\r\n\r\n                        this._filterTimeout = setTimeout(() => clearFade(), this.options.opacityTiming);\r\n                    });\r\n                }\r\n            });\r\n        }\r\n\r\n        destroy() {\r\n            // TODO: do it\r\n        }\r\n\r\n        refresh() {\r\n            // TODO: do it\r\n        }\r\n\r\n        // TODO: private\r\n        layout() {\r\n            if (this.options.masonry) {\r\n                const rowHeight = parseInt(window.getComputedStyle(this._options.element).getPropertyValue('grid-auto-rows'));\r\n                const rowGap = parseInt(window.getComputedStyle(this._options.element).getPropertyValue('grid-row-gap'));\r\n\r\n                this._options.items.filter(item => item.style.display !== 'none').forEach(item => {\r\n                    const rowSpan = Math.ceil((item.querySelector('.content').getBoundingClientRect().height + rowGap) / (rowHeight + rowGap));\r\n                    item.style.gridRowEnd = 'span ' + rowSpan;\r\n                });\r\n            }\r\n        }\r\n\r\n        // TODO: private\r\n        clear() {\r\n            this._options.element.style.position = '';\r\n            this._options.element.style.width = '';\r\n            this._options.element.style.height = '';\r\n            this._options.element.style.transition = '';\r\n\r\n            this._options.items.forEach(item => {\r\n                item.style.transform = '';\r\n                item.style.transformOrigin = '';\r\n                item.style.position = '';\r\n                item.style.transition = '';\r\n                item.style.width = '';\r\n                item.style.height = '';\r\n                item.style.margin = '';\r\n            });\r\n        }\r\n\r\n        // TODO: private\r\n        store(id = 0) {\r\n            const scroll = {\r\n                top: document.body.scrollTop,\r\n                left: document.body.scrollLeft\r\n            };\r\n            const gridRect = this._options.element.getBoundingClientRect();\r\n            if (!('rect' in this._options.element)) {\r\n                this._options.element.rect = [];\r\n            }\r\n            this._options.element.rect[id] = {\r\n                width: gridRect.width,\r\n                height: gridRect.height,\r\n                top: gridRect.top + scroll.top,\r\n                left: gridRect.left + scroll.left\r\n            };\r\n            this._options.items.filter(item => item.style.display !== 'none').forEach(item => {\r\n                if (!('rect' in item)) {\r\n                    item.rect = [];\r\n                }\r\n                const itemRect = item.getBoundingClientRect();\r\n                item.rect[id] = {\r\n                    width: itemRect.width,\r\n                    height: itemRect.height,\r\n                    top: itemRect.top + scroll.top - this._options.element.rect[id].top,\r\n                    left: itemRect.left + scroll.left - this._options.element.rect[id].left,\r\n                    scaleX: 1,\r\n                    scaleY: 1\r\n                };\r\n                item.rect[id].top = item.rect[id].top >= 0 ? item.rect[id].top : 0;\r\n                item.rect[id].left = item.rect[id].left >= 0 ? item.rect[id].left : 0;\r\n                if (id === 1) {\r\n                    const scaleX = item.rect[0].width / itemRect.width;\r\n                    const scaleY = item.rect[0].height / itemRect.height;\r\n                    if (scaleX > 0) {\r\n                        item.rect[id].scaleX = 1 / scaleX;\r\n                    }\r\n                    if (scaleY > 0) {\r\n                        item.rect[id].scaleY = 1 / scaleY;\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        // TODO: private\r\n        transform(id = 0) {\r\n            this._options.element.style.position = 'relative';\r\n            this._options.element.style.width = this._options.element.rect[id].width + 'px';\r\n            this._options.element.style.height = this._options.element.rect[id].height + 'px';\r\n\r\n            this._options.items.filter(item => item.style.display !== 'none').forEach(item => {\r\n                let transform = 'translate3d(' + item.rect[id].left + 'px,' + item.rect[id].top + 'px, 0px)';\r\n\r\n                if (!this.options.animateWidthAndHeight) {\r\n                    transform += ' scale3d(' + item.rect[id].scaleX + ', ' + item.rect[id].scaleY + ', 1)';\r\n                }\r\n\r\n                if (this.options.animateWidthAndHeight || id === 0) {\r\n                    item.style.width = item.rect[id].width + 'px';\r\n                    item.style.height = item.rect[id].height + 'px';\r\n                }\r\n\r\n                item.style.margin = 0;\r\n                item.style.position = 'absolute';\r\n                item.style.transformOrigin = '0 0 0';\r\n                item.style.transform = transform;\r\n            });\r\n        }\r\n    }\n\n    return Griddie;\n\n})));\n"]}