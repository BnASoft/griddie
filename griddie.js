function _objectSpread(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},l=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(l=l.concat(Object.getOwnPropertySymbols(i).filter(function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable}))),l.forEach(function(e){_defineProperty(t,e,i[e])})}return t}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,i=new Array(e.length);t<e.length;t++)i[t]=e[t];return i}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var l=t[i];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}function _classPrivateFieldSet(e,t,i){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");var l=t.get(e);if(!l.writable)throw new TypeError("attempted to set read only private field");return l.value=i}function _classPrivateFieldGet(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e).value}var Griddie=function(){function i(){var s=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,i),_scroller.set(this,{writable:!0,value:document.documentElement||document.body}),_scrollTop.set(this,{writable:!0,value:0}),_scrollLeft.set(this,{writable:!0,value:0}),_element.set(this,{writable:!0,value:void 0}),_items.set(this,{writable:!0,value:void 0}),_options.set(this,{writable:!0,value:void 0}),_isPromise.set(this,{writable:!0,value:function(e){return!!e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof e.then}}),_timer.set(this,{writable:!0,value:null}),_timer2.set(this,{writable:!0,value:null}),_refresh.set(this,{writable:!0,value:function(){_classPrivateFieldGet(s,_element)}}),_layout.set(this,{writable:!0,value:function(){if("instance"in _classPrivateFieldGet(s,_element)){_classPrivateFieldGet(s,_element).style.position="relative";var e=window.getComputedStyle(_classPrivateFieldGet(s,_element)),t=e.getPropertyValue("display");if(_classPrivateFieldGet(s,_options).masonry){"none"===e.getPropertyValue("grid-template-columns")&&(_classPrivateFieldGet(s,_element).style.gridTemplateColumns="repeat(auto-fill, minmax(250px, 1fr))"),"grid"!==t&&(_classPrivateFieldGet(s,_element).style.display="grid");var i=e.getPropertyValue("grid-auto-rows");"auto"===i&&(i=_classPrivateFieldGet(s,_element).style.gridAutoRows="20px"),i=parseInt(i),"normal"===e.getPropertyValue("grid-column-gap")&&(_classPrivateFieldGet(s,_element).style.gridColumnGap="0px");var l=e.getPropertyValue("grid-row-gap");"normal"===l&&(l=_classPrivateFieldGet(s,_element).style.gridRowGap="0px"),l=parseInt(l),_classPrivateFieldGet(s,_items).filter(function(e){return"none"!==e.style.display}).forEach(function(e){var t=Math.ceil((_toConsumableArray(e.children)[0].getBoundingClientRect().height+l)/(i+l));e.style.gridRowEnd="span "+t})}else _classPrivateFieldGet(s,_element).style.display="",_classPrivateFieldGet(s,_element).style.gridTemplateColumns="",_classPrivateFieldGet(s,_element).style.gridAutoRows="",_classPrivateFieldGet(s,_element).style.gridColumnGap="",_classPrivateFieldGet(s,_element).style.gridRowGap="",_classPrivateFieldGet(s,_items).filter(function(e){return"none"!==e.style.display}).forEach(function(e){e.style.gridRowEnd=""})}}}),_clearGridStyles.set(this,{writable:!0,value:function(){"instance"in _classPrivateFieldGet(s,_element)&&(_classPrivateFieldGet(s,_element).style.position="relative",_classPrivateFieldGet(s,_element).style.transform="",_classPrivateFieldGet(s,_element).style.width="",_classPrivateFieldGet(s,_element).style.height="",_classPrivateFieldGet(s,_element).style.transition="",_classPrivateFieldGet(s,_element).style.margin="")}}),_clearItemsStyles.set(this,{writable:!0,value:function(){"instance"in _classPrivateFieldGet(s,_element)&&_classPrivateFieldGet(s,_items).forEach(function(e){e.style.transform="",e.style.transformOrigin="",e.style.position="",e.style.transition="",e.style.width="",e.style.height="",e.style.margin=""})}}),_storeGridData.set(this,{writable:!0,value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;if("instance"in _classPrivateFieldGet(s,_element)){_classPrivateFieldSet(s,_scrollTop,_classPrivateFieldGet(s,_scroller).scrollTop),_classPrivateFieldSet(s,_scrollLeft,_classPrivateFieldGet(s,_scroller).scrollLeft);var t=_classPrivateFieldGet(s,_element).getBoundingClientRect(),i=window.getComputedStyle(_classPrivateFieldGet(s,_element));"rect"in _classPrivateFieldGet(s,_element)||(_classPrivateFieldGet(s,_element).rect=[]),_classPrivateFieldGet(s,_element).rect[e]={width:t.width,height:t.height,top:t.top+_classPrivateFieldGet(s,_scrollTop),left:t.left+_classPrivateFieldGet(s,_scrollLeft),marginTop:parseInt(i.getPropertyValue("margin-top")),marginLeft:parseInt(i.getPropertyValue("margin-left"))}}}}),_storeItemsData.set(this,{writable:!0,value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;"instance"in _classPrivateFieldGet(s,_element)&&(_classPrivateFieldSet(s,_scrollTop,_classPrivateFieldGet(s,_scroller).scrollTop),_classPrivateFieldSet(s,_scrollLeft,_classPrivateFieldGet(s,_scroller).scrollLeft),_classPrivateFieldGet(s,_items).filter(function(e){return"none"!==e.style.display}).forEach(function(e){"rect"in e||(e.rect=[]);var t=e.getBoundingClientRect();if(e.rect[a]={width:t.width,height:t.height,top:t.top+_classPrivateFieldGet(s,_scrollTop)-_classPrivateFieldGet(s,_element).rect[a].top,left:t.left+_classPrivateFieldGet(s,_scrollLeft)-_classPrivateFieldGet(s,_element).rect[a].left,scaleX:1,scaleY:1},e.rect[a].top=0<=e.rect[a].top?e.rect[a].top:0,e.rect[a].left=0<=e.rect[a].left?e.rect[a].left:0,1===a){var i=e.rect[0].width/t.width,l=e.rect[0].height/t.height;0<i&&(e.rect[a].scaleX=1/i),0<l&&(e.rect[a].scaleY=1/l)}}))}}),_applyGridStyles.set(this,{writable:!0,value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;"instance"in _classPrivateFieldGet(s,_element)&&(_classPrivateFieldGet(s,_element).style.margin=0,_classPrivateFieldGet(s,_element).style.position="relative",_classPrivateFieldGet(s,_element).style.transformOrigin="0 0 0",_classPrivateFieldGet(s,_element).style.transform="translate3d("+_classPrivateFieldGet(s,_element).rect[e].marginLeft+"px,"+_classPrivateFieldGet(s,_element).rect[e].marginTop+"px, 0px)",_classPrivateFieldGet(s,_element).style.width=_classPrivateFieldGet(s,_element).rect[e].width+"px",_classPrivateFieldGet(s,_element).style.height=_classPrivateFieldGet(s,_element).rect[e].height+"px")}}),_applyItemsStyles.set(this,{writable:!0,value:function(){var i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;"instance"in _classPrivateFieldGet(s,_element)&&_classPrivateFieldGet(s,_items).filter(function(e){return"none"!==e.style.display}).forEach(function(e){var t="translate3d("+e.rect[i].left+"px,"+e.rect[i].top+"px, 0px)";s.options.scaleXY&&(t+=" scale3d("+e.rect[i].scaleX+", "+e.rect[i].scaleY+", 1)"),s.options.scaleXY&&0!==i||(e.style.width=e.rect[i].width+"px",e.style.height=e.rect[i].height+"px"),e.style.margin=0,e.style.position="absolute",e.style.transformOrigin="0 0 0",e.style.transform=t})}}),_classPrivateFieldSet(this,_element,"string"==typeof e?document.querySelector(e):e),_classPrivateFieldSet(this,_items,_toConsumableArray(_classPrivateFieldGet(this,_element).children)),_classPrivateFieldSet(this,_options,{}),(_classPrivateFieldGet(this,_element).instance=this).options=t,_classPrivateFieldGet(this,_layout).call(this),window.addEventListener("resize",function(){return _classPrivateFieldGet(s,_layout).call(s)})}return _createClass(i,[{key:"animate",value:function(){var a=this,s=0<arguments.length&&void 0!==arguments[0]?arguments[0]:function(){};if("instance"in _classPrivateFieldGet(this,_element))return new Promise(function(e,t){var i=function(){_classPrivateFieldGet(a,_clearGridStyles).call(a),_classPrivateFieldGet(a,_clearItemsStyles).call(a),_classPrivateFieldGet(a,_layout).call(a),_classPrivateFieldGet(a,_storeGridData).call(a,1),_classPrivateFieldGet(a,_storeItemsData).call(a,1),_classPrivateFieldGet(a,_applyGridStyles).call(a,0),_classPrivateFieldGet(a,_applyItemsStyles).call(a,0),requestAnimationFrame(function(){var i="transform "+_classPrivateFieldGet(a,_options).transformTimingCSS+"s ease",l="width "+_classPrivateFieldGet(a,_options).transformTimingCSS+"s ease, height "+_classPrivateFieldGet(a,_options).transformTimingCSS+"s ease";_classPrivateFieldGet(a,_element).style.transition=l+", "+i,_toConsumableArray(_classPrivateFieldGet(a,_items)).filter(function(e){return"none"!==e.style.display}).forEach(function(e){var t=i;a.options.scaleXY||(t+=", "+l),e.style.transition=t}),requestAnimationFrame(function(){_classPrivateFieldGet(a,_applyGridStyles).call(a,1),_classPrivateFieldGet(a,_applyItemsStyles).call(a,1)}),_classPrivateFieldSet(a,_timer,setTimeout(function(){_classPrivateFieldGet(a,_clearGridStyles).call(a),_classPrivateFieldGet(a,_clearItemsStyles).call(a),e()},a.options.transformTiming))})};clearTimeout(_classPrivateFieldGet(a,_timer)),_classPrivateFieldGet(a,_clearGridStyles).call(a),_classPrivateFieldGet(a,_clearItemsStyles).call(a),_classPrivateFieldGet(a,_storeGridData).call(a,0),_classPrivateFieldGet(a,_storeItemsData).call(a,0),_classPrivateFieldGet(a,_applyGridStyles).call(a,0),_classPrivateFieldGet(a,_applyItemsStyles).call(a,0);var l=s(_classPrivateFieldGet(a,_element));_classPrivateFieldGet(a,_isPromise).call(a,l)?l.then(function(){return i()}):requestAnimationFrame(function(){return i()})})}},{key:"filter",value:function(){var l=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"*";if("instance"in _classPrivateFieldGet(this,_element)){var e=_classPrivateFieldGet(this,_items).filter(function(e){return e.matches(t)}),i=_classPrivateFieldGet(this,_items).filter(function(e){return!e.matches(t)}),a=e.filter(function(e){return"none"===e.style.display}),s=e.length!==a.length,r=function(){_classPrivateFieldGet(l,_items).forEach(function(e){e.style.transition="opacity "+_classPrivateFieldGet(l,_options).opacityTimingCSS+"s ease"})},n=function(){e.forEach(function(e){e.style.opacity=1}),i.forEach(function(e){e.style.opacity=0})},o=function(){_classPrivateFieldGet(l,_items).forEach(function(e){e.style.transition="",e.style.opacity=""}),e.forEach(function(e){e.style.display=""}),i.forEach(function(e){e.style.display="none"})};this.animate(function(){return clearTimeout(_classPrivateFieldGet(l,_timer2)),new Promise(function(e,t){var i=function(){_classPrivateFieldGet(l,_storeItemsData).call(l,0),_classPrivateFieldGet(l,_applyGridStyles).call(l,0),_classPrivateFieldGet(l,_applyItemsStyles).call(l,0),e()};r(),a.length&&a.forEach(function(e){e.style.opacity=0}),requestAnimationFrame(function(){a.length&&a.forEach(function(e){e.style.display=""}),a.length&&s?requestAnimationFrame(function(){return i()}):(!a.length||a.length&&!s)&&requestAnimationFrame(function(){n(),_classPrivateFieldSet(l,_timer2,setTimeout(function(){o(),requestAnimationFrame(function(){return i()})},l.options.opacityTiming))})})})}).then(function(){s&&(r(),requestAnimationFrame(function(){n(),clearTimeout(l._filterTimeout),l._filterTimeout=setTimeout(function(){return o()},l.options.opacityTiming)}))})}}},{key:"destroy",value:function(){_classPrivateFieldGet(this,_clearGridStyles).call(this),_classPrivateFieldGet(this,_clearItemsStyles).call(this),_classPrivateFieldGet(this,_items).forEach(function(e){e.style.gridRowEnd="",e.style.display="",delete e.rect}),delete _classPrivateFieldGet(this,_element).rect,clearTimeout(_classPrivateFieldGet(this,_timer)),clearTimeout(_classPrivateFieldGet(this,_timer2)),window.removeEventListener("resize"),delete _classPrivateFieldGet(this,_element).instance}},{key:"options",set:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};_classPrivateFieldSet(this,_options,_objectSpread({},{scaleXY:!1,opacityTiming:300,transformTiming:300,masonry:!1},e)),_classPrivateFieldGet(this,_options).transformTimingCSS=this.options.transformTiming/1e3,_classPrivateFieldGet(this,_options).opacityTimingCSS=this.options.opacityTiming/1e3},get:function(){return _classPrivateFieldGet(this,_options)}}]),i}(),_scroller=new WeakMap,_scrollTop=new WeakMap,_scrollLeft=new WeakMap,_element=new WeakMap,_items=new WeakMap,_options=new WeakMap,_isPromise=new WeakMap,_timer=new WeakMap,_timer2=new WeakMap,_refresh=new WeakMap,_layout=new WeakMap,_clearGridStyles=new WeakMap,_clearItemsStyles=new WeakMap,_storeGridData=new WeakMap,_storeItemsData=new WeakMap,_applyGridStyles=new WeakMap,_applyItemsStyles=new WeakMap;